webpackJsonp([4],{0:function(t,e,i){var a;a=function(t){i(183),i(185),i(186),i(149);var e=i(147),a=i(150),n=i(163),s=i(161),r=i(145),o=i(187),l=i(188),c=e(".dialog-prompt");o.init({className:"custom-prompt",container:".dialog-prompt"}),o.on("show",function(){c.show()}),o.on("hide",function(){c.hide()}),r.init(),l.download(1),function(){function t(t,e,i,a){var n=null,s=null;if(e){if(n=J.create(t,e,i),!n)return!1;switch(n.on("initCanvasSize",function(t){t.canvasSize=h()}),"photoWall"!==t&&(n.on("img.afterFire",function(t,e){2===e&&N(),s&&clearTimeout(s),s=setTimeout(function(){B(t,!0)},200)}),n.on("transform.before",function(){z(!0)}),n.on("transform.done",function(){"multiHolePic"===t?Y.emit("state",!1):N(),z(!1)}),n.on("imgUploadErr",function(t,e){o.black(e)})),t){case"multiHolePic":n.on("setCurrHole",function(t,e){var i=t.getCustomData("image");i?Y.emit("state",i[e],t.getScaleNum(e)):Y.emit("state",!1)});break;case"photoWall":n.on("transform.before",function(){z(!0)}),n.on("transform.done",function(t,e){z(!1),j.isFunction(e)&&e()}),n.on("click.sub",function(t,e,i){tt.draw(e.tplId,e.data,e.sizePX),tt.show(i)})}return"object"==typeof a&&a&&n.setCustomData(a),n}}function c(t,e){function i(i){if(q.init(a.getBom("size")),!t.initData&&(t.initData={}),!t.markName&&(t.markName=t.picType),!i&&!t.isValid)return void(j.isFunction(e)&&e(t));switch(t.picType){case"framePic":;if("multiHolePic"===t.markName)t.initData.frameSize=q.checkSize($t)?$t:q.getMinSizeByShape(2);else{if("framePic"!==t.markName)return;t.initData.size||(t.initData.image?t.initData.size=g(t.initData.image,1,!0):t.initData.size=q.checkSize($t)?$t:q.getMinSizeByShape(2)),t.initData.frameSize=t.initData.size}t.initData.frameSize?a.refactor(t.initData.frameSize,function(){j.isFunction(e)&&e(t)},function(t){o.error(t)}):o.black(It);break;case"photoWall":var n=t.initData.template?t.initData.template.Id:0;a.initTpl(n,function(){j.isFunction(e)&&e(t)},function(t){o.error(t)});break;default:"scrollPic"!==t.picType&&"cupPic"!==t.picType&&"bolsterPic"!==t.picType&&"shirtPic"!==t.picType&&"bagPic"!==t.picType&&!t.initData.size&&(t.initData.size=q.checkSize($t)?$t:q.getMinSizeByShape(2)),j.isFunction(e)&&e(t)}}var a=V[t.picType];return a?(z(!0),void(a.hasInit?i(!1):a.download(function(){i(!0)}))):{error:"不存在此类型的model"}}function h(){var t,i=e("#custom-header").find(".nav").width(),a=533;return t=i>=1200?900:i>=980&&1200>i?680:480,t>a?a:t}function u(i){var a,n,s=null;if(!i||!i.picType)return!1;var r=V[i.picType];if(kt[i.picType]){if(i.isValid)switch(i.picType){case"framePic":"framePic"==i.markName?(s=lt,ct.hide()):(s=ct,lt.hide()),s.show(),s.setCustomData(i.initData,!0).transform(),kt.framePic=s;break;case"rimlessPic":"rimlessPic"==i.markName?(s=mt,ft.hide()):(s=ft,mt.hide()),s.show(),s.setCustomData(i.initData,!0).transform(),kt.rimlessPic=s;break;case"photoWall":s=kt.photoWall,i.initData.subData=r.convertSubData(i.initData.template,i.initData.cusData&&i.initData.cusData.Data.Photos,i.allImg),s.setCustomData(i.initData,!0),s.transform();break;case"scrollPic":s=kt.scrollPic,s.setCustomData(i.initData,!0).transform();break;case"paintPic":s=kt.paintPic,s.setCustomData(i.initData,!0).transform();break;case"cupPic":s=kt.cupPic,s.setCustomData(i.initData,!0).transform();break;case"bolsterPic":s=kt.bolsterPic,s.setCustomData(i.initData,!0).transform();break;case"shirtPic":s=kt.shirtPic,s.setCustomData(i.initData,!0).transform();break;case"bagPic":s=kt.bagPic,s.setCustomData(i.initData,!0).transform()}}else switch(i.picType){case"framePic":lt=t("framePic",rt,null),ct=t("multiHolePic",ot,null),a=r.getInitData(),n=e.extend({},a),delete n.multiMat,n.mat=[a.mat[0]],n.size=i.initData.frameSize,n.image="framePic"==i.markName?i.initData.image:null,lt.setCustomData(n),delete a.mat,a.size={Width:a.multiMat.Properties.Width,Height:a.multiMat.Properties.Height},ct.setCustomData(a),"framePic"==i.markName?(s=lt,ct.hide()):(s=ct,lt.hide()),s.show(),i.isValid&&s.setCustomData(i.initData,!0),s.transform(),kt.framePic=s;break;case"rimlessPic":J.support3d?(dt.addClass("hide"),mt=t("rimlessPic",ut,null)):(dt.removeClass("hide"),ut.addClass("hide"),mt=t("swfRimlessPic",dt,null)),ft=t("rimlessFramePic",pt,null),a=r.getInitData(),a.size=i.initData.size,ft.setCustomData(a),delete a.outerLine,mt.setCustomData(a),"rimlessPic"==i.markName?(s=mt,ft.hide()):(s=ft,mt.hide()),s.show(),i.isValid&&s.setCustomData(i.initData,!0),s.isFlash&&"rimlessFramePic"!=s.markName||s.transform(),kt.rimlessPic=s;break;case"photoWall":s=t("photoWall",e("#photoWall").find(".photoWall-wrap"),null),a=i.isValid?i.initData:r.getInitData(),a.subData=r.convertSubData(a.template,a.cusData&&a.cusData.Data.Photos,i.allImg),s.setCustomData(a,!0),s.transform(),kt.photoWall=s;break;case"scrollPic":s=t("scrollPic",e("#scrollPic").find(".scrollPic-wrap"),null),a=i.isValid?i.initData:r.getInitData(),s.setCustomData(a,!0).transform(),kt.scrollPic=s;break;case"paintPic":s=t("paintPic",e("#paintPic").find(".paintPic-wrap"),{spacer:!0}),i.isValid?s.setCustomData(i.initData,!0):(a=r.getInitData(1),a.size=i.initData.size,s.setCustomData(a,!0)),s.transform(),kt.paintPic=s;break;case"cupPic":s=t("cupPic",e("#cupPic").find(".cupPic-wrap"),null),a=i.isValid?i.initData:r.getInitData(),s.setCustomData(a,!0).transform(),kt.cupPic=s;break;case"bolsterPic":s=t("bolsterPic",e("#bolsterPic").find(".bolsterPic-wrap"),null),a=i.isValid?i.initData:r.getInitData(),s.setCustomData(a,!0).transform(),kt.bolsterPic=s;break;case"shirtPic":s=t("shirtPic",e("#shirtPic").find(".shirtPic-wrap"),null),a=i.isValid?i.initData:r.getInitData(),s.setCustomData(a,!0).transform(),kt.shirtPic=s;break;case"bagPic":s=t("bagPic",e("#bagPic").find(".bagPic-wrap"),null),a=i.isValid?i.initData:r.getInitData(),s.setCustomData(a,!0).transform(),kt.bagPic=s;break;default:return}Tt=kt[i.picType],d(V[i.picType],i.picType,Tt.markName),setTimeout(function(){p(i.picType,Tt),B(Tt),St.emit("afterInit"),i.isValid&&C(i,Tt)})}function d(t,e,i){var n=Pt[e],s=e.indexOf("pw.t")>=0;if(!n){var r=[],o=null,l=A(i);if(!l)return;a.each(l,function(t){return s&&"size"===t.type?!0:(o={type:t.type,name:t.name},void r.push(o))}),Pt[e]={nav:r}}Q.flash(Pt[e].nav,i,t)}function p(t,e){return t&&e?(M(),L(),void N()):!1}function m(t){var e=null,i=null;for(var n in kt)if(kt.hasOwnProperty(n))switch(n){case"framePic":e=lt.getCustomData("image"),i=ct.getCustomData("image"),e&&t==e.Rand&&lt.clearImg(),i&&i.length>0&&a.each(i,function(e,i){e&&t==e.Rand&&ct.clearImg(i)});break;case"rimlessPic":e=mt.getCustomData("image"),e&&t==e.Rand&&mt.clearImg(),e=ft.getCustomData("image"),e&&t==e.Rand&&ft.clearImg();break;case"photoWall":var s=kt.photoWall.getCustomData("template");if(!s)return!1;var r=null;a.each(s.Properties.Photos,function(n,s){switch(r=kt.photoWall.picMap[s],r.markName){case"framePic":e=r.getCustomData("image"),e&&t==e.Rand&&r.clearImg();break;case"multiHolePic":i=r.getCustomData("image"),i&&i.length>0&&a.each(i,function(e,i){e&&t==e.Rand&&r.clearImg(i)})}});break;default:e=kt[n].getCustomData("image"),e&&t==e.Rand&&kt[n].clearImg()}}function f(t,e,i){if(!t||!t.Width||!t.Height)return{error:"invalid sizeObj"};switch(z(!0),e.markName){case"framePic":var a=e.getCustomData("mat"),n=O(e);return n?void n.initMat(t,function(){if(a.length>0){var s=n.getMatByShadeAndColor(a);s&&s.length>0&&e.setCustomData({mat:s})}e.setCustomData({size:t}).transform(),M(),L(),j.isFunction(i)&&i()},function(t){o.black(t),z(!1)}):!1;case"multiHolePic":e.setCustomData({size:t}).transform(),e.removeCurrHole(),Y.setBallOffset();break;default:e.getCustomData("spacer")&&e.setSpacer(),e.setCustomData({size:t}).transform()}M(),L(),j.isFunction(i)&&i()}function g(t,e,i){var a=X.getShape(t),n=q.getData(),s=null;switch(a){case 1:s=n.h;break;case 2:s=n.s;break;case 3:s=n.v}var r=X.getBestSize(t,s,e,i);return r.validSize.length?r.bestSize:(z(!1),console.log("此图只能用于分享"),null)}function v(t,e){if(!t||!e||"photoWall"===e.markName)return console.error("param is undefined"),!1;var i,a=e.getCustomData("mat"),n=V[e.markName];switch(e.markName){case"rimlessFramePic":i=2;break;case"framePic":i=1;break;case"paintPic":i=e.getCustomData("paper")?1:2;break;case"rimlessPic":i=2}t.src=H.image.show+"/"+t.Id+"/800/"+t.File;var s=g(t,i,!(!a||!a[0]));return s?(q.init(n.getValidSize(t,W(e.markName))),e.initImgData(),e.saveImageData(t),z(!0),f(s,e,function(){Y.emit("state",!0)})):(o.black(It),z(!1)),!0}function b(t,e){return t&&e&&"photoWall"!==e.markName?(t.src=H.image.show+"/"+t.Id+"/800/"+t.File,e.saveImageData(t),e.uploadImg(t),!0):!1}function y(t,e){if(!t||!e||"photoWall"===e.markName)return!1;var i=V[e.markName],n=i.template;return t.src=H.image.show+"/"+t.Id+"/800/"+t.File,a.each(n,function(t){t.IsValid=!0}),e.saveImageData(t),e.uploadImg(t),N(),!0}function C(t,e){e&&e.markName==t.markName&&Z.saveCusDataByType(t.picType,e)}function w(t,e){var i=!0;if(!t||!e)return!1;switch(e.markName){case"framePic":case"multiHolePic":e.addLine("line",t);break;case"rimlessFramePic":e.addLine("outerLine",t);break;default:i=!1}return i}function $(t,e,i){return t&&i?j.isFunction(i.addMat)&&i.addMat({site:e,val:t}):!1}function k(t,e){return t&&e&&"multiHolePic"===e.markName?e.addMat(t):!1}function T(t,e){return t&&e?(e.addLine(t,e.getCustomData("craft")),!0):!1}function P(t,e){return t&&e?("paintPic"===e.markName?e.setCustomData({texture:t}):e.setCustomData({paper:t}),!0):!1}function I(t,e){return t&&e?("paintPic"===e.markName?e.setCustomData({texture:t}):e.setCustomData({canvas:t}),!0):!1}function D(t,e,i){var a=null,n=O(e);return t&&e?("scrollPic"===e.markName||"cupPic"===e.markName||"bolsterPic"===e.markName||"shirtPic"===e.markName||"bagPic"===e.markName?(a=n.getInitData(t.Id),e.setCustomData(a).transform(),M(),L()):"photoWall"===e.markName&&(z(!0),n.initTpl(t.Id,function(){e.setCustomData({template:t,subData:n.convertSubData(t)}).transform(),M(),L();for(var a in Pt)Pt.hasOwnProperty(a)&&/pw.t/.test(a)&&(Pt[a]=null);j.isFunction(i)&&i()},function(t){"BomComponentOffline"==t?o.error("物料下线，无法购买"):o.error(t)})),!0):!1}function S(t,e,i){if(!t||!i)return o.black("找不到对应的物料数据"),!1;var a={};return a[e]=t,i.setCustomData(a),!0}function x(t,i){if(!t&&!i)return void console.error("!workId && !workObj");var n="数据异常，初始作品失败（ ＴДＴ）";if(Tt&&Tt.isSub)return kt.photoWall.once("subjoinEv",function(){x(t,i)}),void tt.hide();var s=_();U.getDetailById(t,i,function(t,i){var n=X.convertCustomData(t,i);if(!n){z(!1),o.black("由于相关物料下线，不能初始化作品"),K.clear("work");var r=Tt.getCustomData("cusData");return r&&K.setWorkCartId(r.Id,r.CartId),!1}n.initData.mat&&(n.initData.mat=V.framePic.extendMat(n.initData.mat)),n.initData.multiMat&&(n.initData.multiMat=V.framePic.extendMat([n.initData.multiMat])[0]),n.isValid=!0;var l=null,h=[],d={};switch(a.each(n.images,function(t,e){var i;i=j.getImageSize(t),i.File=t,i.Id=n.ids[e],i.src=H.image.show+i.Id+"/800/"+i.File,d[i.Id]=i}),console.log(n.images),n.initData.image=null,n.initData.imgData=null,n.picType){case"framePic":l=i.Data.Images,"framePic"===n.markName?d&&d[l[0].Id]&&(n.initData.image=d[l[0].Id],n.initData.imgData=l[0]):d&&(a.each(l,function(t,e){d[t.Id]&&(h[e]=d[t.Id])}),n.initData.image=h,n.initData.imgData=l);break;case"photoWall":n.allImg=d;break;case"rimlessPic":case"scrollPic":case"paintPic":l=i.Data.Image,d&&d[l.Id]&&(n.initData.image=d[l.Id],n.initData.imgData=l);var p=i.Data.Border;p&&(n.initData.spacer={top:{mm:p.Top},bottom:{mm:p.Bottom},left:{mm:p.Left},right:{mm:p.Right}});break;case"cupPic":l=i.Data.Image,d&&d[l.Id]&&(n.initData.image=d[l.Id],n.initData.imgData=l);break;case"bolsterPic":case"shirtPic":case"bagPic":l=i.Data.Head,d&&d[l.Id]&&(n.initData.image=d[l.Id],n.initData.imgData=l)}s&&s===n.picType?c(n,function(){u(n)}):e(".custom-nav").find("li[data-type="+n.picType+"] a").trigger("click",[n])},function(t){z(!1),o.black(n),console.error(t)})}function N(){if(!Tt||"photoWall"===Tt.markName||!Tt.getCustomData("image"))return void Y.emit("state",!1);var t=nt.find(".pic-wrap.active .img-target").eq(0),e=E();Y.emit("getScaleMax",t,e,Tt.markName,function(){Y.emit("state",!0),Y.emit("moveBall",Tt.getScaleNum())})}function E(){if(!Tt)return!1;var t=W(Tt.markName),e={};if("framePic"===Tt.markName||"rimlessPic"===Tt.markName||"paintPic"===Tt.markName){var i=Tt.getCustomData("size");e.width=i.Width/25.4*t,e.height=i.Height/25.4*t}else{var a=Tt.getCustomData("template");switch(Tt.markName){case"scrollPic":e.width=a.Properties.Hole.Width/25.4*t,e.height=a.Properties.Hole.Height/25.4*t;break;case"cupPic":e.width=a.Properties.Head.Hole.Width/25.4*t,e.height=a.Properties.Head.Hole.Height/25.4*t;break;case"bolsterPic":case"shirtPic":case"bagPic":e.width=a.Properties.Head.Width/25.4*t,e.height=a.Properties.Head.Height/25.4*t}}return e}function W(t){var e;switch(t){case"framePic":e=n.paperDpi;break;case"rimlessPic":e=n.canvasDpi;break;case"paintPic":var i=Tt.getCustomData("texture");e=4===i.Kind?n.paperDpi:n.canvasDpi;break;case"cupPic":e=n.paperDpi;break;case"scrollPic":case"bolsterPic":case"shirtPic":case"bagPic":e=n.canvasDpi}return e}function B(t,e){if(t){t.isSub&&(t=kt.photoWall),!j.isBoolean(e)&&(e=!1);var i=Z.getCurrStep(),a=t.getCustomData("cusData");a?e?4>i&&Z.showStep(4):Z.showStep(a.CartId?2:3):1!==i&&Z.showStep(1)}}function L(t){if(t){var e=Ct.parent();-1===t.Money||0===t.Money?e.addClass("disable-money"):e.removeClass("disable-money"),-1===t.Money&&(t.Money=0),-1===t.MoneyX&&(t.MoneyX=0),!isNaN(t.Money)&&Ct.text(t.Money/100),!isNaN(t.MoneyX)&&yt.html("￥"+t.MoneyX/100).removeClass("hide")}else{if(Tt.isSub)return;var i=Tt.getMoney();if(i&&-1==i.stat){Ct.parent().addClass("disable-money"),Ct.text(0),yt.addClass("hide");var n="很抱歉，"+("photoWall"===Tt.markName?i.name:"该尺寸下的"+i.name)+"暂不支持制作，分享保留大作吧！";o.black(n,5e3)}else a.isNumber(i)&&(Ct.parent().removeClass("disable-money"),Ct.text(j.getFloor(j.getMoney(i)*Dt)),yt.html("￥"+j.getMoney(i)).removeClass("hide"),o.hide())}}function M(){var t,e,i=Tt.getCustomData("size"),a=null;if("framePic"===Tt.markName||"multiHolePic"===Tt.markName)a=Tt.getCustomData("line"),t=(i.Width+2*a.Properties.Bottom)/10,e=(i.Height+2*a.Properties.Bottom)/10,wt.text(t+"x"+e+"cm");else if("rimlessFramePic"===Tt.markName)a=Tt.getCustomData("outerLine"),t=(i.Width+2*(a.Properties.Gap+a.Properties.Top))/10,e=(i.Height+2*(a.Properties.Gap+a.Properties.Top))/10,wt.text(t+"x"+e+"cm");else if("scrollPic"===Tt.markName){var n=Tt.getCustomData("template");t=n.Properties.Hole.Width/10,e=n.Properties.Hole.Height/10,wt.text(t+"x"+e+"cm")}else"cupPic"===Tt.markName?wt.text("300ml"):"bolsterPic"===Tt.markName?wt.text("45 x 45 cm"):"shirtPic"===Tt.markName?wt.text("均码"):"bagPic"===Tt.markName?wt.text("30 x 23 cm"):(t=i.Width/10,e=i.Height/10,wt.text(t+"x"+e+"cm"))}function A(t){var e=null;switch(t){case"framePic":case"multiHolePic":e=[{type:"size",name:"尺寸"},{type:"line",name:"画框"},{type:"mat",name:"卡纸"},{type:"paper",name:"画纸"},{type:"glass",name:"玻璃"}];break;case"rimlessPic":case"rimlessFramePic":e=[{type:"size",name:"尺寸"},{type:"rimLine",name:"画框"},{type:"canvas",name:"画布"}];break;case"photoWall":e=[{type:"template",name:"模板"}];break;case"scrollPic":e=[{type:"scrollTpl",name:"模板"},{type:"tplCanvas",name:"画布"}];break;case"paintPic":e=[{type:"size",name:"尺寸"},{type:"paper",name:"画纸"},{type:"canvas",name:"画布"},{type:"spacer",name:"留白"}];break;case"cupPic":e=[{type:"cupTpl",name:"模板"}];break;case"bolsterPic":e=[{type:"bolsterTpl",name:"模板"}];break;case"shirtPic":e=[{type:"shirtTpl",name:"模板"}];break;case"bagPic":e=[{type:"bagTpl",name:"模板"}]}return e}function _(){var t=e(".custom-nav").children(".active");return t.data("type")}function z(t){nt.toggleClass("loading",t)}function O(t){if(!t)return!1;var e=null,i=t.getCustomData("depend");if(t.isSub&&i)return V.photoWall.getSubModel(i.idx);switch(t.markName){case"framePic":case"multiHolePic":e=V.framePic;break;case"rimlessPic":case"rimlessFramePic":e=V.rimlessPic;break;case"photoWall":e=V.photoWall;break;case"scrollPic":e=V.scrollPic;break;case"paintPic":e=V.paintPic;break;case"cupPic":e=V.cupPic;break;case"bolsterPic":e=V.bolsterPic;break;case"shirtPic":e=V.shirtPic;break;case"bagPic":e=V.bagPic}return e}var F=i(189),j=i(152),H=i(151),R=i(190),V={framePic:R.Frame,rimlessPic:R.Rimless,photoWall:R.PhotoWall,scrollPic:R.Scroll,paintPic:R.Paint,cupPic:R.Cup,bolsterPic:R.Bolster,shirtPic:R.Shirt,bagPic:R.Bag},q=i(202),U=i(203),J=i(164),X=i(168),G=i(204),Y=i(206),Z=i(209),K=i(210),Q=i(214),tt=i(222),et=i(224),it=e(".custom-wrap"),at=e("#custom-stage"),nt=it.find(".custom-cont"),st=(e(".custom-nav-slider"),e("#framePic")),rt=st.find(".framePic-wrap"),ot=st.find(".multiPic-wrap"),lt=null,ct=null,ht=e("#rimlessPic"),ut=ht.find(".rimlessPic-wrap"),dt=ht.find(".swf-wrap"),pt=ht.find(".rimlessFramePic-wrap"),mt=null,ft=null,gt=e("#hd-upload-img-btn"),vt=e(".bom-detail-modal"),bt=e(".bom-detail-carousel"),yt=e(".ori-price"),Ct=e("#completedMoney"),wt=e("#completedSize"),$t={Width:400,Height:400,Mat:!0},kt={},Tt=null,Pt={},It="图片尺寸太小不能用于定制产品",Dt=.7,St=new s;Q.init(),Q.addGetPicObjEv(function(){return Tt}),Q.on("click.item",function(t,e,i){if(!t||!e)return console.error("type || data is undefined"),!1;if("image"===t){var a=j.getImageSize(e.File);e.Width=a.Width,e.Height=a.Height}if(K.status)return void K.emit("close",function(){i.emit("click.item",t,e)});var n=Tt,s=!1;switch(t){case"image":s=!1,"photoWall"===n.markName?o.black("请点击左侧画框，进行详细定制"):n.isSub||"multiHolePic"===n.markName?"multiHolePic"!==n.markName||n.hasCurrHole()?(b(e,n),B(n,!0)):o.black("请先选中画孔后再添加您的图片"):"scrollPic"===n.markName||"cupPic"===n.markName||"bolsterPic"===n.markName||"shirtPic"===n.markName||"bagPic"===n.markName?(Y.setState(n.markName),y(e,n),B(n,!0),"scrollPic"!==n.markName&&n.on("placeImg.done",function(){var t=n.getFillRate(),e=n.getImageType();Y.setStateByImg(e,t)})):(Y.setState(n.markName),s=v(e,n));break;case"size":f(e,n,function(){B(n,!0),N()});break;case"line":s=w(e,n),s&&M();break;case"innerLine":s=T(e,n),s&&!n.isSub&&(kt.rimlessPic=mt,Tt=mt,mt.show(),ft.hide()),M();break;case"outerLine":"rimlessFramePic"!==n.markName&&(n=ft),s=w(e,n),s&&!n.isSub&&(kt.rimlessPic=ft,Tt=ft,ft.show(),mt.hide()),M();break;case"mat":s=$(e.mat,e.siteName,n),s&&!n.isSub&&(kt.framePic=lt,Tt=lt,ct.hide());break;case"multiMat":"multiHolePic"!==n.markName&&(n=ct),s=k(e,n),s&&!n.isSub&&(kt.framePic=ct,Tt=ct,lt.hide(),ct.show());break;case"paper":s=P(e,n);break;case"canvas":s=I(e,n);break;case"glass":s=S(e,"glass",n);break;case"template":s=D(e,n);break;case"tplCanvas":s=S(e,"canvas",n)}s&&("template"!==t&&"image"!==t&&L(),B(n,!0),N())}),Q.on("del.image.done",function(t){m(t)}),Q.on("show.bomDetail",function(t){xt.setData([t]),vt.modal("show")}),bt.on("click",function(){vt.modal("hide")}),bt.on("click",".cont",function(t){t.stopPropagation()}),bt.on("click",".close",function(){vt.modal("hide")}),Q.on("select.matType",function(t){var e=lt.getCustomData(),i=ct.getCustomData(),a=!1;if("single"===t)i.cusData&&(!e.cusData&&(e.cusData={}),e.cusData.Id=i.cusData.Id),e.paper=i.paper,e.glass=i.glass,lt.setCustomData(e),i.line&&i.line.Id!==e.line.Id&&(a=!0,lt.setCustomData({line:i.line})),lt.show(),ct.hide(),kt.framePic=lt,!a&&lt.hasTransform||lt.transform();else{if("multi"!==t)return;e.cusData&&(!i.cusData&&(i.cusData={}),i.cusData.Id=e.cusData.Id),i.paper=e.paper,i.glass=e.glass,ct.setCustomData(i),e.line&&i.line.Id!==e.line.Id&&(a=!0,ct.setCustomData({line:e.line})),lt.hide(),ct.show(),kt.framePic=ct,!a&&ct.hasTransform||ct.transform()}Tt=kt.framePic,B(Tt,!0),N()}),Q.on("set.matSite",function(t){if(1===t.type)Tt.addMat({site:t.site,val:t.mat});else{if(0!==t.type)return;Tt.removeMat([t.site])}L(),B(Tt,!0)}),Q.on("after.setSpacer",function(t){Tt.setSpacer(t),B(Tt,!0)}),Q.on("select.rimLine",function(t){var i=null,a=!1;if("innerLine"===t){var n=ft.getCustomData(),s=mt.getCustomData("innerLine");s.Id!==n.innerLine.Id&&(a=!0),i=e.extend({},n),delete i.outerLine,mt.setCustomData(i,!0),i.image&&(a=!0),mt.show(),ft.hide(),kt.rimlessPic=mt,!a&&mt.hasTransform||mt.transform()}else{if("outerLine"!==t)return;var r=mt.getCustomData();i=e.extend({},r),i.innerLine=V.rimlessPic.getBomById(32,"innerLine"),ft.setCustomData(i),i.image&&(a=!0),ft.show(),mt.hide(),kt.rimlessPic=ft,!a&&ft.hasTransform||ft.transform()}Tt=kt.rimlessPic,B(Tt,!0),N(),L()}),K.init(),K.addPreEv(function(){var t=_();return t="photoWall"!==t?t.slice(0,t.length-3):"photo-wall"}),K.addActiveWorkEv(function(){if(!Tt)return!1;var t=Tt.getCustomData("cusData");return t?t.Id:!1}),K.on("prompt.error",function(t){o.error(t)}),K.on("work.click",function(t){x(t)}),K.on("before.scene",function(){if(Tt){var t=j.clone(Tt.getCustomData());if("photoWall"===Tt.markName){!t.subData&&(t.subData={});var e=j.clone(Tt.getSubCustomData());t.subData[e.tplId]=e.data}else t.imgData=j.clone(Tt.getImgData());K.emit("scene.getPic",{markName:Tt.markName,customData:t})}}),K.on("del.work.ok",function(t){o.black("删除成功");var e=null;for(var i in kt)if(kt.hasOwnProperty(i))switch(i){case"framePic":e=lt.getCustomData("cusData"),e&&t.id===e.Id&&(lt.setCustomData({cusData:null}),ct.setCustomData({cusData:null}));break;case"rimlessPic":e=mt.getCustomData("cusData"),e&&t.id===e.Id&&(mt.setCustomData({cusData:null}),ft.setCustomData({cusData:null}));break;default:e=kt[i].getCustomData("cusData"),e&&t.id===e.Id&&kt[i].setCustomData({cusData:null})}B(Tt),"image"===Q.getActiveNav()&&Q.clearImg(),t.cartId>0&&r.updateCart()}),K.on("del.work.fail",function(t){o.black(t)}),Z.init(),Z.preStart(function(){K.status&&K.emit("close");var t=_();return{picType:t,picObj:"photoWall"===t?kt.photoWall:Tt,addType:V[t].getPicType()}}).addPromptEv(function(t){o.black(t)}),Z.on("after.save",function(t,e){e.finalData.Money!==t.Money&&L(t.Money);var i={cusData:t};switch(e.picType){case"framePic":lt.setCustomData(i),ct.setCustomData(i);break;case"rimlessPic":mt.setCustomData(i),ft.setCustomData(i);break;case"photoWall":kt.photoWall.setCustomData(i);break;default:e.picObj.setCustomData(i)}L(t)}),Z.on("after.addCart",function(t,e){r.updateCart(),"framePic"===e.picType?lt.setCustomData({cusData:null}):"rimlessPic"===e.picType?(mt.setCustomData({cusData:null}),ft.setCustomData({cusData:null})):"photoWall"===e.picType?kt.photoWall.setCustomData({cusData:null}):e.picObj.setCustomData({cusData:null})}),Z.on("after.customAgain",function(t){"image"===Q.getActiveNav()&&Q.clearImg();var e={cusData:null};"framePic"===t.picType?(lt.setCustomData(e),ct.setCustomData(e),lt.clearImg(),lt.initImgData(),ct.clearImg(null,!0),ct.initImgData(null,!0)):"rimlessPic"===t.picType?(mt.setCustomData(e),ft.setCustomData(e),mt.clearImg(),mt.initImgData(),ft.clearImg(),ft.initImgData()):"photoWall"===t.picType?(kt.photoWall.setCustomData(e),kt.photoWall.clearImg()):(t.picObj.setCustomData(e),t.picObj.clearImg(),t.picObj.initImgData()),N()}),Z.on("after.exitSave",function(t){var i=null;t.isValid=!0,c(t,function(){switch(t.markName){case"framePic":ct.hide(),lt.show(),i=kt.framePic=lt;break;case"multiHolePic":lt.hide(),ct.show(),i=kt.framePic=ct;break;case"rimlessPic":ft.hide(),mt.show(),i=kt.rimlessPic=mt;break;case"rimlessFramePic":mt.hide(),ft.show(),i=kt.rimlessPic=ft;break;default:i=kt[t.picType]}if(i){Tt=i;var a=e.extend(!0,{},t.initData);i.setCustomData(a,!0).transform(),Q.triggerNav("image")}})}),Y.init(),Y.on("rotate",function(t){if(Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")){var e=Tt.getRotateNum();if(1===t?e+=90:2===t&&(e-=90),"multiHolePic"===Tt.markName||"scrollPic"===Tt.markName||"cupPic"===Tt.markName||"bolsterPic"===Tt.markName||"shirtPic"===Tt.markName||"bagPic"===Tt.markName||Tt.isSub)return Tt.setRotate(e),void B(Tt,!0);var i=Tt.getCustomData("size"),a={Width:i.Height,Height:i.Width,Mat:i.Mat};if(Tt.isFlash)return Tt.setCustomData({size:a}),Tt.setRotate(t),M(),L(),Q.emit("after.setSize"),void Tt.emit("img.afterFire",Tt,3);Tt.setRotateNum(e),f(a,Tt,function(){Q.emit("after.setSize"),Tt.emit("img.afterFire",Tt,3)})}}),Y.on("scale",function(t,e){Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")&&Tt.setZoom(t,e)}),Y.on("center.complete",function(){Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")&&Tt.setPosition({left:0})}),Y.on("middle.complete",function(){Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")&&Tt.setPosition({top:0})}),Y.on("full.complete",function(){Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")&&(Tt.setPosition({top:0,left:0}),Tt.setZoom(1,100),Y.setBallOffset(100))}),Y.on("fill.complete",function(t){Tt&&"photoWall"!==Tt.markName&&Tt.getCustomData("image")&&(Tt.setPosition({top:0,left:0}),Tt.setZoom(1,j.getInt(100*t)),Y.setBallOffset(j.getInt(100*t)))});var xt=new G(vt,H.bom.bomIcon);vt.modal({show:!1,backdrop:"static"}),vt.on("show.bs.modal",function(){xt.show()});var Nt=null;tt.init(e(".photoWall-big-wrap")),tt.addGetMainWidthEv(h),tt.on("img.afterFire",function(t,e){2===e&&N(),Nt&&clearTimeout(Nt),Nt=setTimeout(function(){B(t,!0)},200)}),tt.on("imgUploadErr",function(t){o.black(t)}),tt.on("show",function(t,e){var i=e.getCustomData("depend"),a="pw.t"+i.tpl+"_"+i.idx;Tt=e,d(O(e),a,e.markName),!e.hasTransform&&e.transform(),p(a,Tt),Z.setBtnStatus(!0)}),tt.on("hide",function(t,e,i){Z.setBtnStatus(!1),Tt=kt.photoWall,d(V.photoWall,"photoWall","photoWall"),p("photoWall",Tt),kt.photoWall.flashSub(t)}),tt.on("batch",function(t,e){var i=e.getCustomData("depend"),n=V.photoWall.getSubModel(i.idx),s={};for(var r in t)t.hasOwnProperty(r)&&t[r]&&("mat"===r?a.each(t.mat,function(t,i){n.getBomById(t.Id,"mat",i)&&e.setCustomData({mat:{site:i,val:t}})}):n.getBomById(t[r].Id,r)&&(s[r]=t[r]));e.hasTransform=!1,e.setCustomData(s)}),e(".custom-nav").on("click","a",function(t,i){var a=e(this).parent(),n=e("#scene-btn");if("link"===a.data("type"))return!0;if(t.preventDefault(),!a.hasClass("active")){var s=a.data("type"),r=e(this);if("cupPic"===s||"bolsterPic"===s||"shirtPic"===s||"bagPic"===s?(n.addClass("hide"),n.parent().siblings(".line").addClass("hide")):(n.removeClass("hide"),n.parent().siblings(".line").removeClass("hide")),K.status)return void K.emit("close",function(){r.trigger("click",[i])});if(Tt&&Tt.isSub)return kt.photoWall.once("subjoinEv",function(){r.trigger("click",[i])}),void tt.hide();i||(i={isValid:!1,picType:s}),"photoWall"===s?e(".custom-toolbar").hide():e(".custom-toolbar").show(),r.tab("show"),c(i,function(t){z(!1),u(t)})}}),e(".check-detail").on("click",function(t){t.preventDefault();var e=null,i=!1;"photoWall"===Tt.markName?(i=!0,e=Tt.getBom()):e=[Tt.getBom()],xt.setData(e,i),vt.modal("show")}),function(){function t(t,i){e(".custom-nav").find("li[data-type="+t+"] a").trigger("click",[i])}gt.on("click",function(){e("#upload-btn").trigger("click")}),St.once("afterInit",function(){var t=new F,i=e(".bottom");t.setOptions({doneLabel:"开始定制",showBullets:!1,showStepNumbers:!1,highlightClass:"custom-helperLayer",tooltipClass:"custom-tooltip",nextLabel:"下一步",prevLabel:"上一步",steps:[{element:e("#upload-btn")[0],intro:"<span class='step-num'>1</span>点击右侧区域添加图片",position:"left"},{element:e(".custom-toolbar")[0],intro:"<span class='step-num'>2</span>通过缩放和旋转来调整您的图片",position:"top"},{element:e(".bom-list-nav")[0],intro:"<span class='step-num'>3</span>在这里选择材料，进行个性装裱",position:"left"},{element:e(".btn-group-wrap")[0],intro:"<span class='step-num'>4</span>将您的大作加入购物车",position:"left"},{element:e(".share-list")[0],intro:"<span class='step-num'>5</span>将您的作品分享给朋友们"}]}),t.oncomplete(function(){e.cookie("step-guide","1"),i.removeClass("open"),at.removeClass("notransition")}),t.onexit(function(){e.cookie("step-guide","1"),i.removeClass("open"),at.removeClass("notransition")}),t.onbeforechange(function(t){e(t).hasClass("share-list")?(e(".introjs-nextbutton").hide(),e(".introjs-skipbutton").addClass("primary")):e(".introjs-skipbutton").hasClass("primary")&&(e(".introjs-nextbutton").show(),e(".introjs-skipbutton").removeClass("primary"))}),e(".step-btn").on("click",function(e){e.stopPropagation(),Q.triggerNav("image"),setTimeout(function(){at.addClass("notransition"),t.start(),i.addClass("open")},200)})});var i=j.getQueryStringArgs();i.rand?l.downloadImgData(i.rand,function(e){e[0].src=H.image.show+"/"+e[0].ImageId+"/800/"+e[0].File,t("framePic",{picType:"framePic",markName:"framePic",initData:{image:e[0]}})},function(e){console.error(e),t("framePic")}):i.work?U.getSingleFromServer(j.parseNum(i.work),function(t){console.log(t),x(0,t)},function(e){o.black(e),t("framePic")}):t("framePic")}(),function(){et.init({trigger:".coupon-btn"});var t=e(".share-erweima"),i=e(".bottom");e(".share-wrap").hover(function(t){i.addClass("open")},function(){i.removeClass("open"),t.addClass("invisible")}),t.on("click",".close",function(){t.addClass("invisible")}),e(".share-list").on("click",".share-social",function(i){i.preventDefault(),K.status&&K.emit("close");var a,n=_(),s=e(this),r=null;if(r="photoWall"===n?kt.photoWall:Tt,a=r.getFinalData(),!a)return void o.black("您的定制还没完成，不能分享!");var l,c=s.data("type");"weixin"===c?t.removeClass("invisible"):l=window.open("about:blank","_blank");var h=O(r).getPicType(),u=r.getCustomData("cusData"),d=u?H.custom.update+"/"+u.Id:H.custom.add+h;e.ajax({contentType:"application/json;charset=utf-8",type:"POST",url:d,data:JSON.stringify(a),dataType:"JSON",success:function(i){return i&&i.Error?void o.black(i.Error):void(i&&(r.setCustomData({cusData:i}),"weixin"===c?e.get(H.social.share.weixin,{CustomId:i.Id},function(e){return e&&e.Error?void o.black(e.Error):void(e&&j.onImgEvent("data:image/png;base64,"+e.qr,function(e){t.find(".code").attr("src",e.src)}))}).error(function(t){o.black(t.responseText)}):e.get(H.share.custom,{Mode:c,CustomId:i.Id},function(t){return t&&t.Error?void o.black(t.Error):void(l.location=t.Url)})))},error:function(t){l.close(),o.black(t.responseText)}})})}()}()}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},145:function(t,e,i){var a;a=function(t,e,a){function n(){s.get(r.user.message.getUnreadCount,function(t){t.Count>0&&(v.css("position:relative"),v.append('<i class="red-point"></i>'))})}i(146),i(149);var s=i(147),r=(i(150),i(151)),o=i(152),l=s(".nav-search"),c=s(".nav-search-content"),h=s(".nav-search-result"),u=s(".nav-search-result li"),d=s(".nav-search .wa-search"),p=s(".nav-search .wa-close"),m=s(".nav-search-open-btn"),f=s(".search-tips"),g=s(".search-zzc"),v=s(".wa-e-mail"),b={};a.exports={init:function(t){this.$body=s("html, body"),this.$header=s(".top-navbar"),this.$discLink=s(".discovery"),this.$weChat=s(".contact-wechat"),this.$dropdown=this.$header.find(".navbar-nav .dropdown"),this.$cartNum=this.$header.find(".add-cart-count"),this.$cartWrap=this.$header.find(".cart-item a"),this.$goTop=s("#back-to-top"),this.$userItem=s(".user-item"),b=s.extend({},b,"object"==typeof t&&t),this.$dropdown.hover(function(){s(this).addClass("menu-open")},function(){s(this).removeClass("menu-open")}),this._initGo2Top(),this.setCookie(),this.setContactPosition(),this.getMsgStatus(),this.searchControl()},_initGo2Top:function(){var t=this;s(window).on("scroll",function(e){t.goTopFn(s(this).scrollTop())}),this.$goTop.on("click",function(e){e.preventDefault();var i=s(this);t.$body.animate({scrollTop:0},500,function(){i.removeClass("active")})}),this.goTopFn(s(window).scrollTop())},goTopFn:function(t){t>120&&this.$goTop.addClass("active"),0==t&&this.$goTop.removeClass("active")},setCookie:function(){var t=this,e=new Date,i=localStorage.getItem("cCurDate"),a=localStorage.getItem("cCurDate");i&&a?(i!==e&&(localStorage.setItem("hasDiscoried",!1),localStorage.setItem("cCurDate",e)),a===!1?t.$discLink.removeClass("readed"):t.$discLink.addClass("readed")):(localStorage.setItem("hasDiscoried",!1),localStorage.setItem("cCurDate",e)),t.$discLink.on("click",function(){localStorage.setItem("hasDiscoried",!0),t.$discLink.addClass("readed")})},setContactPosition:function(){var t=this;t.$weChat.on("click",".contact-close",function(){t.$weChat.remove()})},updateCart:function(){var t=this;s.get("/checklogin",function(e){e&&o.isNumber(e.cart)&&(t.$cartNum.html(e.cart),s.support.transition&&(t.$cartWrap.addClass("cart-animate"),t.$cartWrap.offsetWidth,
t.$cartWrap.one("bsTransitionEnd",function(){t.$cartWrap.removeClass("cart-animate")}).emulateTransitionEnd(400)))})},getMsgStatus:function(){var t=this.$userItem.data("id");t&&setInterval(function(){n()},6e4)},searchControl:function(){u.on("click",function(t){if(c.val(s(this).text()),h.toggle(),"-1"==location.href.indexOf("/public/list")){var e=c.val();sessionStorage.setItem("query",e),location.href="/public/list"}}),c.on("click",function(t){t.stopPropagation(),h.show()}),p.on("click",function(t){c.val(""),l.hide(),m.show(),g.hide()}),d.on("click",function(){if("-1"==location.href.indexOf("/public/list")){var t=c.val();sessionStorage.setItem("query",t),location.href="/public/list"}}),c.keypress(function(t){var e=s(this),i=t.which;s.trim(e.val());if(13==i){if("-1"!=location.href.indexOf("/public/list"))return;var a=c.val();sessionStorage.setItem("query",a),location.href="/public/list"}}).on("keyup",function(){s(this).val()?h.hide():h.show()}).on("focus",function(){f.show(),h.show(),g.show()}).on("blur",function(){f.hide()}),m.on("click",function(){s(this).hide(),l.show(),g.show(),c.focus()}),g.on("click",function(){s(this).hide(),p.click(),f.hide()})}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},146:function(t,e,i){var a;a=function(t){"use strict";function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}var a=i(147);a.fn.emulateTransitionEnd=function(t){var e=!1,i=this;a(this).one("bsTransitionEnd",function(){e=!0});var n=function(){e||a(i).trigger(a.support.transition.end)};return setTimeout(n,t),this},a(function(){a.support.transition=e(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(t){return a(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},183:function(t,e){},185:function(t,e,i){var a;a=function(t){"use strict";function e(t){return this.each(function(){var e=a(this),i=e.data("bs.tab");i||e.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var a=i(147),n=function(t){this.element=a(t)};n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,e=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var n=e.find(".active:last a"),s=a.Event("hide.bs.tab",{relatedTarget:t[0]}),r=a.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(s),t.trigger(r),!r.isDefaultPrevented()&&!s.isDefaultPrevented()){var o=a(i);this.activate(t.closest("li"),e),this.activate(o,o.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},n.prototype.activate=function(t,e,i){function s(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var r=e.find("> .active"),o=i&&a.support.transition&&(r.length&&r.hasClass("fade")||!!e.find("> .fade").length);r.length&&o?r.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),r.removeClass("in")};var s=a.fn.tab;a.fn.tab=e,a.fn.tab.Constructor=n,a.fn.tab.noConflict=function(){return a.fn.tab=s,this}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},186:function(t,e,i){var a;a=function(t){"use strict";function e(t,e){return this.each(function(){var i=a(this),s=i.data("bs.modal"),r=a.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);s||i.data("bs.modal",s=new n(this,r)),"string"==typeof t?s[t](e):r.show&&s.show(e)})}var a=i(147),n=function(t,e){this.options=e,this.$body=a(document.body),this.$element=a(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.0",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},n.prototype.show=function(t){var e=this,i=a.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var i=a.support.transition&&e.$element.hasClass("fade");e.$element.parent().length||e.$element.appendTo(e.$body),e.$element.show().scrollTop(0),i&&e.$element[0].offsetWidth,e.$element.addClass("in").attr("aria-hidden",!1),e.enforceFocus();var s=a.Event("shown.bs.modal",{relatedTarget:t});i?e.$element.find(".modal-dialog").one("bsTransitionEnd",function(){e.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(n.TRANSITION_DURATION):e.$element.trigger("focus").trigger(s)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=a.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var e=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=a.support.transition&&i;if(this.$backdrop=a('<div class="modal-backdrop '+i+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",a.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;s?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){e.removeBackdrop(),t&&t()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):r()}else t&&t()},n.prototype.checkScrollbar=function(){this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",t+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},n.prototype.measureScrollbar=function(){if(document.body.clientWidth>=window.innerWidth)return 0;var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var s=a.fn.modal;a.fn.modal=e,a.fn.modal.Constructor=n,a.fn.modal.noConflict=function(){return a.fn.modal=s,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var i=a(this),n=i.attr("href"),s=a(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),r=s.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(n)&&n},s.data(),i.data());i.is("a")&&t.preventDefault(),s.one("show.bs.modal",function(t){t.isDefaultPrevented()||s.one("hidden.bs.modal",function(){i.is(":visible")&&i.trigger("focus")})}),e.call(s,r,this)})}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},187:function(t,e,i){var a;a=function(t,e,a){function n(t){var e=new RegExp("alert-\\w","g"),i=e.exec(t);return i?i[0]:!1}var s=i(147),r=i(161),o='<div id="prompt" class="ww-prompt"><div class="alert"></div></div>',l={className:"static-prompt",interval:2e3,container:"body"},c=new r;c.init=function(t){this.options=s.extend({},l,"object"==typeof t&&t),this.$ele=null,this.timer=null;var e=s("#prompt"),i=this;e.length||s(this.options.container).append(o),this.$ele=s("#prompt"),this.$alert=this.$ele.children(".alert"),this.$ele.addClass(this.options.className),this.$ele.off("click"),this.$ele.on("click",function(){i.hide()})},c.promptMsg=function(t,e,i){var a=n(this.$alert.attr("class")),s=t?"alert-"+t:null;this.timer&&clearTimeout(this.timer),!a&&s?this.$alert.addClass(s):a!=s&&(this.$alert.removeClass(a),s&&this.$alert.addClass(s)),this.$alert.html(e),this.$ele.addClass("active"),this.emit("show");var r=this;this.timer=setTimeout(function(){r.hide()},i||this.options.interval)},c.hide=function(){this.timer&&clearTimeout(this.timer),this.$ele.removeClass("active"),this.emit("hide")},c.success=function(t,e){this.promptMsg("success",t,e)},c.error=function(t,e){this.promptMsg("danger",t,e)},c.info=function(t,e){this.promptMsg("info",t,e)},c.warning=function(t,e){this.promptMsg("warning",t,e)},c.black=function(t,e){this.promptMsg("black",t,e)},a.exports=c}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},188:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(150),r=i(151),o=i(163),l=o.IMGPAGESIZE,c={download:function(t,e,i){var a=this;t||(t=1),n.getJSON(r.image.paging,{Page:t,Count:l},function(n){n.Error?s.isFunction(i)&&i(n.Error):(console.log(n),a.init(n,t),s.isFunction(e)&&e())}).error(function(t){s.isFunction(i)&&i(t.responseText)})},init:function(t,e){var i=t.Data;if(this.data=this.data||[],s.isArray(i)&&i.length>0)for(var a=0,n=i.length;n>a&&i[a];a++)this.data[a+(e-1)*l]=i[a];this.pager=t.Pager},removeFormServer:function(t,e,i){if(!t)return!1;var a=this;n.get(r.image.remove+"/"+t,function(n){if(n&&n.Error)return void(s.isFunction(i)&&i(n.Error));if(n){var r=a.remove(t);s.isFunction(e)&&e(r)}}).error(function(t){s.isFunction(i)&&i(t.statusText)})},remove:function(t){var e=this.data;if(!e)return!1;for(var i=0,a=e.length;a>i&&(!e[i]||e[i].Id!=t);i++);return e.splice(i,1)},getData:function(t){var e=[];if(t)for(var i=(t-1)*l,a=t*l;a>i&&this.data[i];i++)e.push(this.data[i]);else e=s.isArray(this.data)?this.data.slice():null;return e},getPager:function(){return n.extend({},this.pager)},getImgById:function(t){var e=this.data,i=null;return e?(s.every(e,function(e){return e&&e.Id==t?(i=e,!1):!0}),i):!1},getTotalPage:function(){return this.pager.TotalPage},getList:function(t,e){this.download(t,e)},addNewImg:function(t){s.isArray(this.data)&&this.data.unshift(t)},downloadImgData:function(t,e,i){if(!t)return!1;if(s.isArray(t)){var a="";s.each(t,function(e){a+="Id="+t+"&"}),a=a.slice(0,a.length-1)}else a="Id="+t;n.get(r.image.getById+"?"+a,function(t){t&&!t.Error&&s.isFunction(e)&&e(t)}).error(function(t){s.isFunction(i)&&i(t.statusText)})}};a.exports=c}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},189:function(t,e,i){var a;a=function(t,e,i){function a(t){this._targetElement=t,this._options={nextLabel:"下一步 &rarr;",prevLabel:"&larr; 上一步",skipLabel:"跳过",doneLabel:"完成",tooltipPosition:"bottom",tooltipClass:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,overlayOpacity:.8,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1}}function n(t){var e=[],i=this;if(this._options.steps)for(var a=[],n=0,r=this._options.steps.length;r>n;n++){var h=s(this._options.steps[n]);if(h.step=e.length+1,"string"==typeof h.element&&(h.element=document.querySelector(h.element)),"undefined"==typeof h.element||null==h.element){var u=document.querySelector(".introjsFloatingElement");null==u&&(u=document.createElement("div"),u.className="introjsFloatingElement",document.body.appendChild(u)),h.element=u,h.position="floating"}null!=h.element&&e.push(h)}else{var a=t.querySelectorAll("*[data-intro]");if(a.length<1)return!1;for(var n=0,d=a.length;d>n;n++){var m=a[n],f=parseInt(m.getAttribute("data-step"),10);f>0&&(e[f-1]={element:m,intro:m.getAttribute("data-intro"),step:parseInt(m.getAttribute("data-step"),10),tooltipClass:m.getAttribute("data-tooltipClass"),highlightClass:m.getAttribute("data-highlightClass"),position:m.getAttribute("data-position")||this._options.tooltipPosition})}for(var g=0,n=0,d=a.length;d>n;n++){var m=a[n];if(null==m.getAttribute("data-step")){for(;;){if("undefined"==typeof e[g])break;g++}e[g]={element:m,intro:m.getAttribute("data-intro"),step:g+1,tooltipClass:m.getAttribute("data-tooltipClass"),highlightClass:m.getAttribute("data-highlightClass"),position:m.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var v=[],b=0;b<e.length;b++)e[b]&&v.push(e[b]);if(e=v,e.sort(function(t,e){return t.step-e.step}),i._introItems=e,y.call(i,t)){o.call(i);t.querySelector(".introjs-skipbutton"),t.querySelector(".introjs-nextbutton");i._onKeyDown=function(e){if(27===e.keyCode&&1==i._options.exitOnEsc)c.call(i,t),void 0!=i._introExitCallback&&i._introExitCallback.call(i);else if(37===e.keyCode)l.call(i);else if(39===e.keyCode)o.call(i);else if(13===e.keyCode){var a=e.target||e.srcElement;a&&a.className.indexOf("introjs-prevbutton")>0?l.call(i):a&&a.className.indexOf("introjs-skipbutton")>0?c.call(i,t):o.call(i),e.preventDefault?e.preventDefault():e.returnValue=!1}},i._onResize=function(t){p.call(i,document.querySelector(".introjs-helperLayer")),p.call(i,document.querySelector(".introjs-tooltipReferenceLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",i._onKeyDown,!0),window.addEventListener("resize",i._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",i._onKeyDown),document.attachEvent("onresize",i._onResize))}return!1}function s(t){if(null==t||"object"!=typeof t||"undefined"!=typeof t.nodeType)return t;var e={};for(var i in t)e[i]=s(t[i]);return e}function r(t){this._currentStep=t-2,"undefined"!=typeof this._introItems&&o.call(this)}function o(){if(this._direction="forward","undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void c.call(this,this._targetElement);var t=this._introItems[this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,t.element),f.call(this,t)}function l(){if(this._direction="backward",0===this._currentStep)return!1;var t=this._introItems[--this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,t.element),f.call(this,t)}function c(t){var e=t.querySelector(".introjs-overlay");if(null!=e){e.style.opacity=0,setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},500);var i=t.querySelector(".introjs-helperLayer");i&&i.parentNode.removeChild(i);var a=t.querySelector(".introjs-tooltipReferenceLayer");a&&a.parentNode.removeChild(a);var n=t.querySelector(".introjs-disableInteraction");n&&n.parentNode.removeChild(n);var s=document.querySelector(".introjsFloatingElement");s&&s.parentNode.removeChild(s);var r=document.querySelector(".introjs-showElement");r&&(r.className=r.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""));var o=document.querySelectorAll(".introjs-fixParent");if(o&&o.length>0)for(var l=o.length-1;l>=0;l--)o[l].className=o[l].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}}function h(t,e,i,a){var n,s,r,o="";if(e.style.top=null,e.style.right=null,e.style.bottom=null,e.style.left=null,e.style.marginLeft=null,e.style.marginTop=null,i.style.display="inherit","undefined"!=typeof a&&null!=a&&(a.style.top=null,a.style.left=null),this._introItems[this._currentStep]){n=this._introItems[this._currentStep],o="string"==typeof n.tooltipClass?n.tooltipClass:this._options.tooltipClass,e.className=("introjs-tooltip "+o).replace(/^\s+|\s+$/g,"");var o=this._options.tooltipClass;currentTooltipPosition=this._introItems[this._currentStep].position,"auto"!=currentTooltipPosition&&"auto"!=this._options.tooltipPosition||"floating"!=currentTooltipPosition&&(currentTooltipPosition=u.call(this,t,e,currentTooltipPosition));var l=C(t),c=C(e).height,h=v();switch(currentTooltipPosition){case"top":e.style.left="15px",e.style.top="-"+(c+10)+"px",i.className="introjs-arrow bottom";break;case"right":e.style.left=C(t).width+20+"px",l.top+c>h.height&&(i.className="introjs-arrow left-bottom",e.style.top="-"+(c-l.height-20)+"px"),i.className="introjs-arrow left";break;case"left":1==this._options.showStepNumbers&&(e.style.top="15px"),l.top+c>h.height?(e.style.top="-"+(c-l.height-20)+"px",i.className="introjs-arrow right-bottom"):i.className="introjs-arrow right",e.style.right=l.width+20+"px";break;case"floating":i.style.display="none",s=C(e),e.style.left="50%",e.style.top="50%",e.style.marginLeft="-"+s.width/2+"px",e.style.marginTop="-"+s.height/2+"px","undefined"!=typeof a&&null!=a&&(a.style.left="-"+(s.width/2+18)+"px",a.style.top="-"+(s.height/2+18)+"px");break;case"bottom-right-aligned":i.className="introjs-arrow top-right",e.style.right="0px",e.style.bottom="-"+(C(e).height+10)+"px";break;case"bottom-middle-aligned":r=C(t),s=C(e),i.className="introjs-arrow top-middle",e.style.left=r.width/2-s.width/2+"px",e.style.bottom="-"+(s.height+10)+"px";break;case"bottom-left-aligned":case"bottom":default:e.style.bottom="-"+(C(e).height+10)+"px",e.style.left=C(t).width/2-C(e).width/2+"px",i.className="introjs-arrow top"}}}function u(t,e,i){var a=this._options.positionPrecedence.slice(),n=v(),s=C(e).height+10,r=C(e).width+20,o=C(t),l="floating";return o.left+r>n.width||o.left+o.width/2-r<0?(d(a,"bottom"),d(a,"top")):(o.height+o.top+s>n.height&&d(a,"bottom"),o.top-s<0&&d(a,"top")),o.width+o.left+r>n.width&&d(a,"right"),o.left-r<0&&d(a,"left"),a.length>0&&(l=a[0]),i&&"auto"!=i&&a.indexOf(i)>-1&&(l=i),l}function d(t,e){t.indexOf(e)>-1&&t.splice(t.indexOf(e),1)}function p(t){if(t){if(!this._introItems[this._currentStep])return;var e=this._introItems[this._currentStep],i=C(e.element),a=10;"floating"==e.position&&(a=0),t.setAttribute("style","width: "+(i.width+a)+"px; height:"+(i.height+a)+"px; top:"+(i.top-5)+"px;left: "+(i.left-5)+"px;")}}function m(){var t=document.querySelector(".introjs-disableInteraction");null===t&&(t=document.createElement("div"),t.className="introjs-disableInteraction",this._targetElement.appendChild(t)),p.call(this,t)}function f(t){"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,t.element);var e=this,i=document.querySelector(".introjs-helperLayer"),a=document.querySelector(".introjs-tooltipReferenceLayer"),n="introjs-helperLayer";C(t.element);if("string"==typeof t.highlightClass&&(n+=" "+t.highlightClass),"string"==typeof this._options.highlightClass&&(n+=" "+this._options.highlightClass),null!=i){var s=a.querySelector(".introjs-helperNumberLayer"),r=a.querySelector(".introjs-tooltiptext"),u=a.querySelector(".introjs-arrow"),d=a.querySelector(".introjs-tooltip"),f=a.querySelector(".introjs-skipbutton"),y=a.querySelector(".introjs-prevbutton"),$=a.querySelector(".introjs-nextbutton");if(i.className=n,d.style.opacity=0,d.style.display="none",null!=s){var k=this._introItems[t.step-2>=0?t.step-2:0];(null!=k&&"forward"==this._direction&&"floating"==k.position||"backward"==this._direction&&"floating"==t.position)&&(s.style.opacity=0)}p.call(e,i),p.call(e,a);var T=document.querySelectorAll(".introjs-fixParent");if(T&&T.length>0)for(var P=T.length-1;P>=0;P--)T[P].className=T[P].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var I=document.querySelector(".introjs-showElement");I.className=I.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),e._lastShowElementTimer&&clearTimeout(e._lastShowElementTimer),e._lastShowElementTimer=setTimeout(function(){null!=s&&(s.innerHTML=t.step),r.innerHTML=t.intro,d.style.display="block",h.call(e,t.element,d,u,s),a.querySelector(".introjs-bullets li > a.active").className="",a.querySelector('.introjs-bullets li > a[data-stepnumber="'+t.step+'"]').className="active",a.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style","width:"+w.call(e)+"%;"),d.style.opacity=1,s&&(s.style.opacity=1),-1===$.tabIndex?f.focus():$.focus()},350)}else{var D=document.createElement("div"),S=document.createElement("div"),x=document.createElement("div"),N=document.createElement("div"),E=document.createElement("div"),W=document.createElement("div"),B=document.createElement("div"),L=document.createElement("div");D.className=n,S.className="introjs-tooltipReferenceLayer",p.call(e,D),p.call(e,S),this._targetElement.appendChild(D),this._targetElement.appendChild(S),x.className="introjs-arrow",E.className="introjs-tooltiptext",E.innerHTML=t.intro,W.className="introjs-bullets",this._options.showBullets===!1&&(W.style.display="none");for(var M=document.createElement("ul"),P=0,A=this._introItems.length;A>P;P++){var _=document.createElement("li"),z=document.createElement("a");z.onclick=function(){e.goToStep(this.getAttribute("data-stepnumber"))},P===t.step-1&&(z.className="active"),z.href="javascript:void(0);",z.innerHTML="&nbsp;",z.setAttribute("data-stepnumber",this._introItems[P].step),_.appendChild(z),M.appendChild(_)}W.appendChild(M),B.className="introjs-progress",this._options.showProgress===!1&&(B.style.display="none");var O=document.createElement("div");if(O.className="introjs-progressbar",O.setAttribute("style","width:"+w.call(this)+"%;"),B.appendChild(O),L.className="introjs-tooltipbuttons",this._options.showButtons===!1&&(L.style.display="none"),N.className="introjs-tooltip",N.appendChild(E),N.appendChild(W),N.appendChild(B),1==this._options.showStepNumbers){var F=document.createElement("span");F.className="introjs-helperNumberLayer",F.innerHTML=t.step,S.appendChild(F)}N.appendChild(x),S.appendChild(N);var $=document.createElement("a");$.onclick=function(){e._introItems.length-1!=e._currentStep&&o.call(e)},$.href="javascript:void(0);",$.innerHTML=this._options.nextLabel;var y=document.createElement("a");y.onclick=function(){0!=e._currentStep&&l.call(e)},y.href="javascript:void(0);",y.innerHTML=this._options.prevLabel;var f=document.createElement("a");f.className="introjs-button introjs-skipbutton",f.href="javascript:void(0);",f.innerHTML=this._options.skipLabel,f.onclick=function(){e._introItems.length-1==e._currentStep&&"function"==typeof e._introCompleteCallback&&e._introCompleteCallback.call(e),e._introItems.length-1!=e._currentStep&&"function"==typeof e._introExitCallback&&e._introExitCallback.call(e),c.call(e,e._targetElement)},L.appendChild(f),this._introItems.length>1&&(L.appendChild(y),L.appendChild($)),N.appendChild(L),h.call(e,t.element,N,x,F)}this._options.disableInteraction===!0&&m.call(e),y.removeAttribute("tabIndex"),$.removeAttribute("tabIndex"),0==this._currentStep&&this._introItems.length>1?(y.className="introjs-button introjs-prevbutton introjs-disabled",y.tabIndex="-1",$.className="introjs-button introjs-nextbutton",f.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(f.innerHTML=this._options.doneLabel,y.className="introjs-button introjs-prevbutton",$.className="introjs-button introjs-nextbutton introjs-disabled",$.tabIndex="-1"):(y.className="introjs-button introjs-prevbutton",$.className="introjs-button introjs-nextbutton",f.innerHTML=this._options.skipLabel),$.focus(),t.element.className+=" introjs-showElement";var j=g(t.element,"position");"absolute"!==j&&"relative"!==j&&(t.element.className+=" introjs-relativePosition");for(var H=t.element.parentNode;null!=H&&"body"!==H.tagName.toLowerCase();){var R=g(H,"z-index"),V=parseFloat(g(H,"opacity")),q=g(H,"transform")||g(H,"-webkit-transform")||g(H,"-moz-transform")||g(H,"-ms-transform")||g(H,"-o-transform");(/[0-9]+/.test(R)||1>V||"none"!==q)&&(H.className+=" introjs-fixParent"),H=H.parentNode}if(!b(t.element)&&this._options.scrollToElement===!0){var U=t.element.getBoundingClientRect(),J=v().height,X=U.bottom-(U.bottom-U.top),G=U.bottom-J;0>X||t.element.clientHeight>J?window.scrollBy(0,X-30):window.scrollBy(0,G+100)}"undefined"!=typeof this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,t.element)}function g(t,e){var i="";return t.currentStyle?i=t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle&&(i=document.defaultView.getComputedStyle(t,null).getPropertyValue(e)),i&&i.toLowerCase?i.toLowerCase():i}function v(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}function b(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom+80<=window.innerHeight&&e.right<=window.innerWidth}function y(t){var e=document.createElement("div"),i="",a=this;if(e.className="introjs-overlay","body"===t.tagName.toLowerCase())i+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",e.setAttribute("style",i);else{var n=C(t);n&&(i+="width: "+n.width+"px; height:"+n.height+"px; top:"+n.top+"px;left: "+n.left+"px;",e.setAttribute("style",i))}return t.appendChild(e),e.onclick=function(){1==a._options.exitOnOverlayClick&&(c.call(a,t),void 0!=a._introExitCallback&&a._introExitCallback.call(a))},setTimeout(function(){i+="opacity: "+a._options.overlayOpacity.toString()+";",e.setAttribute("style",i)},10),!0}function C(t){var e={};e.width=t.offsetWidth,e.height=t.offsetHeight;for(var i=0,a=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft,a+=t.offsetTop,t=t.offsetParent;return e.top=a,e.left=i,e}function w(){var t=parseInt(this._currentStep+1,10);return t/this._introItems.length*100}function $(t,e){var i={};for(var a in t)i[a]=t[a];for(var a in e)i[a]=e[a];return i}var k="1.0.0",T=function(t){if("object"==typeof t)return new a(t);if("string"==typeof t){var e=document.querySelector(t);if(e)return new a(e);throw new Error("There is no element with given selector.")}return new a(document.body)};T.version=k,T.fn=a.prototype={clone:function(){return new a(this)},setOption:function(t,e){return this._options[t]=e,this},setOptions:function(t){return this._options=$(this._options,t),this},start:function(){return n.call(this,this._targetElement),this},goToStep:function(t){return r.call(this,t),this},nextStep:function(){return o.call(this),this},previousStep:function(){return l.call(this),this},exit:function(){return c.call(this,this._targetElement),this},refresh:function(){return p.call(this,document.querySelector(".introjs-helperLayer")),p.call(this,document.querySelector(".introjs-tooltipReferenceLayer")),this},onbeforechange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=t,this},onchange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=t,this},onafterchange:function(t){if("function"!=typeof t)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=t,this},oncomplete:function(t){if("function"!=typeof t)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=t,this},onexit:function(t){if("function"!=typeof t)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=t,this}},i.exports=T}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},190:function(t,e,i){var a;a=function(t,e,a){var n=i(191),s=i(192),r=i(194),o=i(195),l=i(196),c=i(197),h=i(198),u=i(199),d=i(200),p=i(201),m=new n,f=new n,g=new n,v=new n,b=new n,y=new n,C=new n,w=new n,$=new n;m.extend(s),m.refactor=function(t,e,i){t&&this.initMat(t,e,i)},f.extend(r),g.extend(o),v.extend(l),y.extend(h),b.extend(c),C.extend(u),w.extend(d),$.extend(p),a.exports={Frame:m,Rimless:f,PhotoWall:g,Scroll:v,Paint:b,Cup:y,Bolster:C,Shirt:w,Bag:$}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},191:function(t,e,i){var a;a=function(t,e,i){i.exports=function(t){var e=function(){this.init.apply(this,arguments)};if(t){var i=function(){};i.prototype=t.prototype,e.prototype=new i}return e.fn=e.prototype,e.fn.parent=e,e._super=e.__proto__,e.fn.init=function(){},e.extend=function(t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e.include=function(t){for(var i in t)t.hasOwnProperty(i)&&(e.fn[i]=t[i])},e}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},192:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(151),r=i(150),o=i(152),l=i(191),c=i(193),h=["line","mat","multiMat","paper","glass"],u=new l,d={picType:"frame",hasMat:!1,initMat:function(t,e,i){if(t){var a=this;n.getJSON(s.bom.mat,{Width:t.Width,Height:t.Height},function(n){return n&&n.Error?(i(n.Error),!1):void(n?(n=a.extendMat(n),a.mat=[n,n,n],a.hasMat=!0,e(n)):i("尺寸："+t.Width+"x"+t.Height+" 下没有对应的卡纸"))}).error(function(t){i(t.status)})}},extendMat:function(t){var e=null;if(r.isArray(t)&&t.length>0){var i,a,n;r.each(t,function(t){e=o.clone(t.Properties),i=e.Width,e.Width=e.Height,e.Height=i,r.each(e.Holes,function(t){a=t.Left,t.Left=e.Width-t.Height-t.Top,t.Top=a,n=t.Width,t.Width=t.Height,t.Height=n}),t.PropertiesX=e})}return t},checkMatData:function(){var t=this.mat;return t?!(t[0]&&t[0].length<=0&&t[1]&&t[1].length<=0&&t[2]&&t[2].length<=0):!1},initMultiMat:function(t){return this.multiMat=this.extendMat(t),this},getInitData:function(t,e){var i=this,a={},n=null;if(e)for(var s in e)e.hasOwnProperty(s)&&this[s]&&("mat"==s?(a.mat=[],o.isArray(e[s])&&r.each(e[s],function(t,e){a.mat[e]=i.getBomById(t,"mat",e)})):a[s]=this.getBomById(e[s],s));else r.each(h,function(e,s){1==t&&"multiMat"==e||2==t&&"mat"==e||("mat"==e?a.mat=i.getInitMat():(n=i.getBomById(0,e),a[e]=r.isArray(n)?n[0]:n))});return a},getInitMat:function(){var t=[],e=null;return this.mat&&(e=this.mat,e[0]&&t.push(e[0][0]),e[1]&&t.push(e[1][0]),e[2]&&t.push(e[2][0])),t},getBomById:function(t,e,i){if(!this[e])return!1;if(r.isNumber(t)){if("mat"===e)return i=i||0,this.getMatById(t,i);var a=this[e];if(0===t){if("size"==e&&r.isArray(a)){for(var n=0,s=a.length;s>n&&"40x40"!=a[n].Name;n++);return n==a.length?a[0]:a[n]}return a[0]}for(var o=0,l=a.length;l>o&&a[o].Id!=t;o++);return a[o]}return!1},getMatById:function(t,e){if(!this.mat)return!1;var i=this.mat[e],a=null;return i?0===t?i[0]:(r.every(i,function(e,i){return e.Id==t?(a=e,!1):!0}),a):!1},getMatByShadeAndColor:function(t,e){if(!this.mat)return{error:"没有卡纸数据"};if(!t)return!1;e=r.isBoolean(e)?e:!0;var i,a,n,s=t[0],o=t[1],l=t[2],c=null,h=[];if(e){var u=this.mat[0];r.each(u,function(t){c=t.Properties,s&&(c.Color&&s.Properties.Color&&c.Color==s.Properties.Color||c.Shade&&s.Properties.Shade&&c.Shade.Image==s.Properties.Shade.Image)&&(i=t),o&&(c.Color&&o.Properties.Color&&c.Color==o.Properties.Color||c.Shade&&o.Properties.Shade&&c.Shade.Image==o.Properties.Shade.Image)&&(a=t),
l&&(c.Color&&l.Properties.Color&&c.Color==l.Properties.Color||c.Shade&&l.Properties.Shade&&c.Shade.Image==l.Properties.Shade.Image)&&(n=t)}),s&&!i&&(n=this.getMatById(0,0)),o&&!a&&(a=this.getMatById(0,1)),l&&!n&&(n=this.getMatById(0,2))}return i&&(h[0]=i),i&&a&&(h[1]=a),i&&a&&n&&(h[2]=n),h},getList:function(t,e,i){if("mat"===i)return[this.getMatListBySite(t,e,0),this.getMatListBySite(t,e,1),this.getMatListBySite(t,e,2)];var a=this[i],n=[];if(r.isArray(a)&&a.length>0)for(var s=t;e>s&&a[s];s++)n.push(a[s]);return n.length>0?n:null},getTotalPage:function(t,e,i){var a=null;if("mat"===e){if(0!==i&&1!==i&&2!==i){var n=this.getAllMatBySite(0),s=this.getAllMatBySite(1),o=this.getAllMatBySite(2);return[r.isArray(n)&&n.length>0?Math.ceil(n.length/t):0,r.isArray(s)&&s.length>0?Math.ceil(s.length/t):0,r.isArray(o)&&n.length>0?Math.ceil(o.length/t):0]}a=this.getAllMatBySite(i)}else a=this[e];return r.isArray(a)&&a.length>0?Math.ceil(a.length/t):0},getMatListBySite:function(t,e,i){if(!this.mat||!this.mat[i])return!1;var a=this.mat[i],n=[];if(r.isArray(a)&&a.length>0)for(var s=t;e>s&&a[s];s++)n.push(a[s]);return n},getAllMatBySite:function(t){return this.mat&&this.mat[t]?this.mat[t]:!1}};u.extend(c),u.extend(d),a.exports=u}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},193:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(150),r=i(151),o=["frame","rimless","photo-wall","scroll","paint","cup","bolster","shirt","bag"];a.exports={picType:"picture",hasInit:!1,getPicType:function(){return this.picType},download:function(t,e){if(-1===n.inArray(this.picType,o))return void e(this.picType+" 不是有效的商品类型！");var i=r.bom.bom+this.picType,a=this;n.getJSON(i,function(i){return i&&i.Error?void e(i.Error):(a.init(i),void t())}).error(function(t){e(t.status)})},show:function(t,e){this.hasInit?t():this.download(t,e)},init:function(t){if(t){var e;for(var i in t)if(t.hasOwnProperty(i))switch(e=i.toLowerCase()){case"size":this.originSizeArr=t[i],this.initSize(t[i]);break;case"matx":this.initMultiMat(t[i]);break;case"innerline":this.innerLine=t[i];break;case"outerline":this.outerLine=t[i];break;default:this[e]=t[i]}return this.hasInit=!0,this}},initSize:function(t){if(s.isArray(t)&&t.length>0){var e={s:[],v:[],h:[]};s.each(t,function(t){t.Width===t.Height?e.s.push(t):t.Width<=t.Height&&(e.v.push(t),e.h.push({Width:t.Height,Height:t.Width,Mat:t.Mat}))}),e.h.length>0&&(e.h=s.sortBy(e.h,"Width")),this.size=e}return this},getList:function(t,e,i){var a=this[i],n=[];if(s.isArray(a)&&a.length>0)for(var r=t;e>r&&a[r];r++)n.push(a[r]);return n.length>0?n:null},getTotalPage:function(t,e){var i=this[e];return s.isArray(i)&&i.length>0?Math.ceil(i.length/t):0},getBomById:function(t,e){if(!this[e])return!1;var i=this[e],a=null;return 0===t?("size"===e&&s.isArray(i)?s.every(i,function(t,e){return"40x40"===t.Name?(a=t,!1):!0}):a=i[0],a):(s.every(i,function(e,i){return e.Id==t?(a=e,!1):!0}),a)},getBom:function(t){return this[t]},getValidSize:function(t,e){var i=this,a=t.Width,n=t.Height,r={s:[],v:[],h:[]};for(var o in i.size)s.each(i.size[o],function(t){var i=t.Width/25.4*e,s=t.Height/25.4*e;(a>i&&n>s||n>i&&a>s)&&r[o].push(t)});return r},getGroupData:function(t){var e,i=null,a=null,n=this,s={};for(var r in t)if(t.hasOwnProperty(r)){if(e=r.toLocaleLowerCase(),i=n[e],!i)continue;if(a=[],"mat"===e){s.mat=[];for(var o=0,l=t[r].length;l>o;o++)s[e][o]=n.getDataByIds(t[r][o],e)}else s[e]=n.getDataByIds(t[r],e)}return s},getDataByIds:function(t,e){var i=null,a=this;return s.isArray(t)?(i=[],s.each(t,function(t){i.push(a.getBomById(t,e))})):i=a.getBomById(t,e),i},filterBom:function(t){if(t){var e=null,i=[];for(var a in t)t.hasOwnProperty(a)&&s.isArray(t[a])&&this[a]&&(i=[],e=this[a],s.each(e,function(e){-1===s.indexOf(t[a],e.Id)&&i.push(e)}),this[a]=i)}}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},194:function(t,e,i){var a;a=function(t,e,a){var n=i(150),s=i(191),r=i(193),o=["innerLine","outerLine","canvas"],l=new s,c={picType:"rimless",getInitData:function(t,e){var i={},a=null,s=this;if(e)for(var r in e)e.hasOwnProperty(r)&&this[r]&&(i[r]=this.getBomById(e[r],r));else n.each(o,function(e){"outerLine"===e&&1===t||(a=s.getBomById(0,e),i[e]=n.isArray(a)?a[0]:a)}),i.craft=2;return i}};l.extend(r),l.extend(c),a.exports=l}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},195:function(t,e,i){var a;a=function(t,e,a){function n(t,e){var i=[];return u.each(t,function(t){u.each(e,function(e){t===e.Id&&i.push(e)})}),i}var s=i(191),r=i(193),o=i(192),l=i(194),c=i(151),h=i(147),u=i(150),d=new s,p={picType:"photo-wall",hasSubBomData:!1,tplData:[],subModel:[],initTpl:function(t,e,i){t||(t=this.getBomById(0,"template").Id);var a=this;h.getJSON(c.bom.template+t,function(n){return n&&n.Error?(i(n.Error),!1):void(n&&(a.setSubModel(t,n),a.hasSubBomData=!0,e()))}).error(function(t){i(t.status)})},getInitData:function(t){return t=t||0,{template:this.getBomById(t,"template")}},setSubModel:function(t,e,i){var a,r,c=null,h=null,d=null,p=this;if(u.isNumber(t))c=this.getBomById(t,"template");else{if(!(t&&t.Id&&i))return;c=t}u.each(c.Properties.Photos,function(t,i){switch(d=new s,t.Type){case 1:case 2:d.extend(o);break;case 3:case 4:d.extend(l)}h=t.Custom;for(a in h)if(h.hasOwnProperty(a)){switch(r=a.toLowerCase()){case"matx":r="multiMat";break;case"innerline":r="innerLine";break;case"outerline":r="outerLine"}"Mat"===a?(d.mat=[],h[a][0]&&(d.mat[0]=d.extendMat(n(h[a][0],e))),h[a][1]&&(d.mat[1]=d.extendMat(n(h[a][1],e))),h[a][2]&&(d.mat[2]=d.extendMat(n(h[a][2],e)))):"multiMat"===r?d[r]=d.extendMat(n(h[a],e)):d[r]=n(h[a],e)}p.subModel[i]=d})},getSubModel:function(t){return this.subModel[t]},convertSubData:function(t,e,i){if(!t)return!1;var a,n,s,r=this,o=[],l=null,c=null,h=null,d=null;return u.each(t.Properties.Photos,function(p,m){if(l=r.getSubModel(m),e&&e[m]){h=e[m],c={};for(a in h)if(h.hasOwnProperty(a)&&h[a]){if("Images"===a||"Image"===a||"Width"===a||"Height"===a)continue;switch(a){case"Mat":h.Images.length>1?c.multiMat=l.getBomById(h.Mat[0],"multiMat"):(c.mat=[],u.each(h.Mat,function(t,e){n=l.getBomById(t,"mat"),n&&(c.mat[e]=n)}));break;case"InnerLine":c.innerLine=l.getBomById(h.InnerLine,"innerLine");break;case"OuterLine":c.outerLine=l.getBomById(h.OuterLine,"outerLine");break;default:s=a.toLowerCase(),c[s]=l.getBomById(h[a],s)}}if(console.log(h.Images),i)switch(p.Type){case 1:c.image=i[h.Images[0].Id],c.imgData=c.image?h.Images[0]:null;break;case 2:d=[],u.each(h.Images,function(t,e){i[t.Id]&&(d[e]=i[t.Id])}),c.image=d,c.imgData=h.Images;break;default:c.image=i[h.Image.Id],c.imgData=c.image?h.Image:null}o[m]=c}else o[m]=l.getInitData();o[m].size={Width:p.Hole.Width,Height:p.Hole.Height,Mat:!0},o[m].depend={tpl:t.Id,idx:m}}),o}};d.extend(r),d.extend(p),a.exports=d}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},196:function(t,e,i){var a;a=function(t,e,a){var n=i(150),s=i(191),r=i(193),o=new s,l={picType:"scroll",getInitData:function(t){t=t||0;var e=this.getBomById(t,"template"),i=this.getSizeByTpl(e);return this.tplCanvas=this.getCanvasByTpl(e),{template:e,size:i,canvas:this.tplCanvas[0]}},getCanvasByTpl:function(t){var e=t.Properties.Canvas,i=[],a=this;return n.each(e,function(t){i.push(a.getBomById(t,"canvas"))}),i},getSizeByTpl:function(t){return t?{Width:t.Properties.Width,Height:t.Properties.Height}:!1}};o.extend(r),o.extend(l),a.exports=o}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},197:function(t,e,i){var a;a=function(t,e,a){var n=i(191),s=i(193),r=new n,o={picType:"paint",getInitData:function(t,e){var i={};if(e){var a=null;for(var n in e)e.hasOwnProperty(n)&&("Texture"===n?(a=this.getBomById(e[n],"paper"),a||(a=this.getBomById(e[n],"canvas")),i.texture=a):i[n]=this.getBomById(e[n],n))}else i={texture:1==t?this.canvas[0]:this.paper[0]};return i}};r.extend(s),r.extend(o),a.exports=r}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},198:function(t,e,i){var a;a=function(t,e,a){var n=(i(150),i(191)),s=i(193),r=new n,o={picType:"cup",getInitData:function(t){t=t||0;var e=this.getBomById(t,"template"),i=this.getSizeByTpl(e);return{template:e,size:i}},getSizeByTpl:function(t){return t?{Width:t.Properties.Head.Width,Height:t.Properties.Head.Height}:!1}};r.extend(s),r.extend(o),a.exports=r}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},199:function(t,e,i){var a;a=function(t,e,a){var n=(i(150),i(191)),s=i(193),r=new n,o={picType:"bolster",getInitData:function(t){t=t||0;var e=this.getBomById(t,"template"),i=this.getSizeByTpl(e);return{template:e,size:i}},getSizeByTpl:function(t){return t?{Width:t.Properties.Width,Height:t.Properties.Height}:!1}};r.extend(s),r.extend(o),a.exports=r}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},200:function(t,e,i){var a;a=function(t,e,a){var n=(i(150),i(191)),s=i(193),r=new n,o={picType:"shirt",getInitData:function(t){t=t||0;var e=this.getBomById(t,"template"),i=this.getSizeByTpl(e);return{template:e,size:i}},getSizeByTpl:function(t){return t?{Width:t.Properties.Head.Width,Height:t.Properties.Head.Height}:!1}};r.extend(s),r.extend(o),a.exports=r}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},201:function(t,e,i){var a;a=function(t,e,a){var n=(i(150),i(191)),s=i(193),r=new n,o={picType:"bag",getInitData:function(t){t=t||0;var e=this.getBomById(t,"template"),i=this.getSizeByTpl(e);return{template:e,size:i}},getSizeByTpl:function(t){return t?{Width:t.Properties.Head.Width,Height:t.Properties.Head.Height}:!1}};r.extend(s),r.extend(o),a.exports=r}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},202:function(t,e,i){var a;a=function(t,e,a){function n(t){if(!t)return 0;var e=t.Width,i=t.Height;return e>i?1:e==i?2:3}var s=i(150);a.exports={init:function(t){this.data=t},getData:function(){return this.data},getMinSizeByShape:function(t){var e=null;if(!this.data)return!1;switch(t){case 1:e=this.data.h;break;case 2:e=this.data.s;break;case 3:e=this.data.v}return e?e[0]:!1},checkSize:function(t){var e,i=n(t),a=null;if(!this.data)return!1;switch(i){case 1:a=this.data.h;break;case 2:a=this.data.s;break;case 3:a=this.data.v}return a?(e=s.every(a,function(e){return!(e.Width===t.Width&&e.Height===t.Height)}),!e):!1}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},203:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(150),r=i(163),o=i(151),l=r.WORKPAGESIZE;a.exports={download:function(t,e,i){var a=this;t||(t=1),n.getJSON(o.custom.getWorkList,{Page:t,Count:l},function(n){return n&&n.Error?void(s.isFunction(i)&&i(n.Error)):void(n&&(a.init(n,t),s.isFunction(e)&&e()))}).error(function(t){s.isFunction(i)&&i(t.responseText)})},getSingleFromServer:function(t,e,i){return t?void n.get(o.custom.getById+t,function(t){return t&&t.Error?void(s.isFunction(i)&&i(t.Error)):void(t&&s.isFunction(e)&&e(t))}).error(function(t){s.isFunction(i)&&i(t.responseText)}):!1},getDetailById:function(t,e,i,a){if(!e&&(e=this.getById(t)),!e)return!1;var r=this.getBomIdsByObj(e),l="";return!r||r.length<=0?(s.isFunction(a)&&a("数据异常，无法进行初始化"),!1):(s.each(r,function(t){0!==t&&t&&(l+="Id="+t+"&")}),l="?"+l.slice(0,l.length-1),void n.get(o.bom.get+l,function(t){return t&&t.Error?void(s.isFunction(a)&&a(t.Error)):void(t&&s.isFunction(i)&&i(t,e))}).error(function(t){s.isFunction(a)&&a(t.responseText)}))},getBomIdsByObj:function(t){if(!t||!t.Data)return!1;var e=t.Data,i=[];switch(t.CategoryId){case 1:i=[e.Line,e.Paper,e.Glass],s.each(e.Mat,function(t){i.push(t)});break;case 2:i=[e.Canvas,e.InnerLine,e.OuterLine];break;case 3:i=[e.Template];break;case 4:i=[e.Template,e.Canvas];break;case 5:i=[e.Texture];break;case 6:case 7:case 8:case 9:i=[e.Template]}return i},init:function(t,e){var i=t.Data;if(this.data=this.data||[],s.isArray(i)&&i.length>0)for(var a=0,n=i.length;n>a&&i[a];a++)this.data[a+(e-1)*l]=i[a];this.pager=t.Pager},remove:function(t){var e,i=this.data;return i?(s.every(i,function(a,n){return a&&i.Id==t?(e=n,!1):!0}),i.splice(e,1)):!1},removeFormServer:function(t,e,i){if(!t)return!1;var a=this;n.get(o.custom.removeById+"/"+t,function(n){if(n&&n.Error)return void(s.isFunction(i)&&i(n.Error));if(n){var r=a.remove(t);s.isFunction(e)&&e(r)}}).error(function(t){s.isFunction(i)&&i(t.statusText)})},getData:function(t){var e=[];if(!this.data)return!1;if(t)for(var i=(t-1)*l,a=t*l;a>i&&this.data[i];i++)e.push(this.data[i]);else e=this.data.slice();return e},getPager:function(){return n.extend({},this.pager)},getById:function(t){var e=this.data,i=null;return e?(s.every(e,function(e){return e&&e.Id==t?(i=e,!1):!0}),i):!1},getTotalPage:function(){return this.pager.TotalPage}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},204:function(t,e,i){var a;a=function(t,e,a){i(205);var n=i(147),s=i(152),r=new EJS({url:"/src/tpl/custom/bom-detail-tpl"}),o={},l=function(t,e){this.$element=t,this.bomIconUrl=e,this.$prevBtn=t.find(".left.carousel-control"),this.$nextBtn=t.find(".right.carousel-control"),this.$itemInner=t.find(".detail-inner"),this.$carouselWrap=t.find(".bom-detail-carousel"),l.regEv.call(this)};l.regEv=function(){var t=this;this.$itemInner.on("click",".icon",function(){n(this).siblings(".active").removeClass("active"),n(this).addClass("active");var e=n(this).parent().siblings(".img-wrap");t.resetDetail({$wrap:e,title:n(this).attr("title"),msg:n(this).data("msg"),src:n(this).data("src")}),e.parents(".item").data("load",1)}),this.$carouselWrap.carousel({interval:!1}),this.$carouselWrap.on("slide.bs.carousel",function(t){var e=n(t.relatedTarget);e.data("load")||e.find(".icon").eq(0).trigger("click")})},l.fn=l.prototype,l.fn.resetDetail=function(t){var e=t.$wrap,i=e.find(".detail-img"),a=e.siblings(".detail-title"),n=e.siblings(".detail-info");if(t.src){var r=this.bomIconUrl+t.src;o[t.src]?(i.attr("src",r),e.removeClass("loading error")):(e.addClass("loading"),s.onImgEvent(r,function(){o[t.src]=!0,i.attr("src",r),e.removeClass("loading error")},function(){o[t.src]=!1,e.removeClass("loading").addClass("error")}))}else e.removeClass("loading").addClass("error");a.html(t.title),n.html(t.msg)},l.fn.setData=function(t,e){this.data=t,this.isPW=e},l.fn.show=function(){this.initItem()},l.fn.initItem=function(){var t=r.render({data:this.data,url:this.bomIconUrl,isPW:this.isPW});return this.$itemInner.children(".item").remove(),this.$itemInner.append(t),this.data.length>1?(this.$prevBtn.removeClass("hide"),this.$nextBtn.removeClass("hide")):(this.$prevBtn.addClass("hide"),this.$nextBtn.addClass("hide")),this.$itemInner.children(".item").eq(0).find(".icon").eq(0).trigger("click"),this},a.exports=l}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},205:function(t,e,i){var a;a=function(t){"use strict";function e(t){return this.each(function(){var e=a(this),i=e.data("bs.carousel"),s=a.extend({},n.DEFAULTS,e.data(),"object"==typeof t&&t),r="string"==typeof t?t:s.slide;i||e.data("bs.carousel",i=new n(this,s)),"number"==typeof t?i.to(t):r?i[r]():s.interval&&i.pause().cycle()})}var a=i(147),n=function(t,e){this.$element=a(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=e,this.paused=this.sliding=this.interval=this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};n.VERSION="3.3.0",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(t){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},n.prototype.getItemForDirection=function(t,e){var i="prev"==t?-1:1,a=this.getItemIndex(e),n=(a+i)%this.$items.length;return this.$items.eq(n)},n.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return t>this.$items.length-1||0>t?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",this.$items.eq(t))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){return this.sliding?void 0:this.slide("next")},n.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},n.prototype.slide=function(t,e){var i=this.$element.find(".item.active"),s=e||this.getItemForDirection(t,i),r=this.interval,o="next"==t?"left":"right",l="next"==t?"first":"last",c=this;if(!s.length){if(!this.options.wrap)return;s=this.$element.find(".item")[l]()}if(s.hasClass("active"))return this.sliding=!1;var h=s[0],u=a.Event("slide.bs.carousel",{relatedTarget:h,direction:o});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var d=a(this.$indicators.children()[this.getItemIndex(s)]);d&&d.addClass("active")}var p=a.Event("slid.bs.carousel",{relatedTarget:h,direction:o});return a.support.transition&&this.$element.hasClass("slide")?(s.addClass(t),s[0].offsetWidth,i.addClass(o),s.addClass(o),i.one("bsTransitionEnd",function(){s.removeClass([t,o].join(" ")).addClass("active"),i.removeClass(["active",o].join(" ")),c.sliding=!1,setTimeout(function(){c.$element.trigger(p)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(i.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(p)),r&&this.cycle(),this}};var s=a.fn.carousel;a.fn.carousel=e,a.fn.carousel.Constructor=n,a.fn.carousel.noConflict=function(){return a.fn.carousel=s,this};var r=function(t){var i,n=a(this),s=a(n.attr("data-target")||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var r=a.extend({},s.data(),n.data()),o=n.attr("data-slide-to");o&&(r.interval=!1),e.call(s,r),o&&s.data("bs.carousel").to(o),t.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var t=a(this);e.call(t,t.data())})})}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},206:function(t,e,i){var a;a=function(t,e,a){i(207),i(208);var n=i(147),s=i(152),r=i(161),o=1,l=new r;l.on("moveBall",function(t){this.initScaleVal=t?t:this.scaleMin,l.setBallOffset(this.initScaleVal)}),l.on("state",function(t,e){l.changeState(t),l.emit("moveBall",e)}),l.on("getScaleMax",function(t,e,i,a){var n,r,o,l,c,h=this,u=t,d=e;if(u.height()>0){switch(n=u.attr("src").split("/"),r=n[n.length-1],o=s.getImageSize(r),l=s.getFloor(parseInt(o.Width)/parseInt(d.width)*100),c=s.getFloor(parseInt(o.Height)/parseInt(d.height)*100),l=l>100?l:100,c=c>100?c:100,i){case"cupPic":case"bolsterPic":case"shirtPic":case"bagPic":h.scaleMin=10;break;default:h.scaleMin=100}h.scaleMax=l>c?l:c,h.diffVal=h.scaleMax-h.scaleMin,s.isFunction(a)&&a()}else u.load(function(){switch(n=u.attr("src").split("/"),r=n[n.length-1],o=s.getImageSize(r),l=s.getFloor(parseInt(o.Width)/parseInt(d.width)*100),c=s.getFloor(parseInt(o.Height)/parseInt(d.height)*100),l=l>100?l:100,c=c>100?c:100,i){case"cupPic":case"bolsterPic":case"shirtPic":case"bagPic":h.scaleMin=10;break;default:h.scaleMin=100}h.scaleMax=l>c?l:c,h.diffVal=h.scaleMax-h.scaleMin,s.isFunction(a)&&a()})}),l.init=function(){this.$ele=n(".image-actions"),this.$vMiddleBtn=this.$ele.find(".v-align-middle"),this.$hCenterBtn=this.$ele.find(".h-align-center"),this.$fillBtn=this.$ele.find(".imagine-fill"),this.$fullBtn=this.$ele.find(".imagine-full"),this.fillRate=null,this.$element=n(".custom-toolbar"),this.$ball=this.$element.find(".zoom-ball"),this.$opeBtn=this.$element.find(".ope-btn"),this.$zoomBar=this.$element.find(".zoom-bar"),this.$zoomLine=this.$element.find(".zoom-line"),this.$zoomActiveLine=this.$element.find(".zoom-active-line"),this.$scaleCount=this.$element.find("#scale-count"),this.scaleMax=null,this.scaleMin=100,this.diffVal=null,this.initScaleVal=100,this._regEv()},l._regEv=function(){var t,e=this,i=null,a=this.$zoomLine.width(),r=null;e.$opeBtn.off(),e.$ball.hammer().off(),e.$hCenterBtn.off(),e.$vMiddleBtn.off(),e.$fullBtn.off(),e.$fillBtn.off(),e.$opeBtn.on("click",function(t){if(t.preventDefault(),t.stopPropagation(),!e.$element.hasClass("disable")){var a=n(this).data("type");switch(i&&clearTimeout(i),a){case 1:e.initScaleVal-=o;break;case 2:e.initScaleVal+=o;break;case 3:break;case 4:}e.initScaleVal=e.initScaleVal>e.scaleMax?e.scaleMax:e.initScaleVal,e.initScaleVal=e.initScaleVal<e.scaleMin?e.scaleMin:e.initScaleVal,1!=a&&2!=a||(i=setTimeout(function(){e.emit("scale",a,e.initScaleVal),e.setBallOffset(e.initScaleVal),e.$scaleCount.html(e.initScaleVal+"%")},20)),3!=a&&4!=a||(a=3===a?1:2,i=setTimeout(function(){e.emit("rotate",a)},20))}}),e.$ball.hammer().on("panstart",function(i){i.stopPropagation(),i.preventDefault(),r=n(this),t=e.$ball.position().left,e.$element.hasClass("disable")}).on("panmove",function(i){if(i.preventDefault(),i.stopPropagation(),!e.$element.hasClass("disable")&&r){var n,o,l;n=t+i.gesture.deltaX,o=n/a,e.initScaleVal=s.getFloor(e.diffVal*o+e.scaleMin),e.initScaleVal>e.scaleMax?e.initScaleVal=e.scaleMax:e.initScaleVal<e.scaleMin&&(e.initScaleVal=e.scaleMin),l=n>0?2:1,e.$scaleCount.html(s.getInt(e.initScaleVal+"%")),e.emit("scale",l,e.initScaleVal),e.setBallOffset(e.initScaleVal)}}).on("panend",function(){t=e.$ball.position().left,r=null}),e.$hCenterBtn.on("click",function(){n(this).hasClass("disable")||(i&&clearTimeout(i),i=setTimeout(function(){e.emit("center.complete")},50))}),e.$vMiddleBtn.on("click",function(){n(this).hasClass("disable")||(i&&clearTimeout(i),i=setTimeout(function(){e.emit("middle.complete")},50))}),e.$fullBtn.on("click",function(){n(this).hasClass("disable")||(i&&clearTimeout(i),i=setTimeout(function(){e.emit("full.complete")},50))}),e.$fillBtn.on("click",function(){n(this).hasClass("disable")||(i&&clearTimeout(i),i=setTimeout(function(){e.emit("fill.complete",e.fillRate)},50))})},l.setBallOffset=function(t){var e=(t-this.scaleMin)/this.diffVal*100;this.$scaleCount.html(t+"%"),this.$ball.css("left",e+"%"),this.$zoomActiveLine.css("width",e+"%")},l.setState=function(t){switch(this.$vMiddleBtn.removeClass("disable"),this.$hCenterBtn.removeClass("disable"),this.$fillBtn.removeClass("disable"),this.$fullBtn.removeClass("disable"),t){case"framePic":case"rimlessPic":case"scrollPic":case"paintPic":this.$fillBtn.addClass("disable")}},l.setStateByImg=function(t,e){switch(this.fillRate=e,t){case"full":this.$fillBtn.hasClass("disable")&&this.$fillBtn.removeClass("disable"),this.$fillBtn.hasClass("disable")&&this.$fullBtn.removeClass("disable");break;case"oneSide":this.$fillBtn.hasClass("disable")&&this.$fillBtn.removeClass("disable"),this.$fullBtn.addClass("disable");break;case"small":this.$fillBtn.addClass("disable"),this.$fullBtn.addClass("disable");break;default:return}},l.changeState=function(t){t?(this.$element.removeClass("disable"),this.$scaleCount.html(this.initScaleVal+"%")):(this.$vMiddleBtn.addClass("disable"),this.$hCenterBtn.addClass("disable"),this.$fillBtn.addClass("disable"),this.$fullBtn.addClass("disable"),this.$element.addClass("disable"),this.$ball.css("left","0%"),this.$zoomActiveLine.css("width","0%"))},a.exports=l}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},207:function(t,e,i){var a;a=function(t,e,i){"use strict";function a(t,e,i){return setTimeout(c(t,i),e)}function n(t,e,i){return Array.isArray(t)?(s(t,i[e],i),!0):!1}function s(t,e,i){var a;if(t)if(t.forEach)t.forEach(e,i);else if(void 0!==t.length)for(a=0;a<t.length;)e.call(i,t[a],a,t),a++;else for(a in t)t.hasOwnProperty(a)&&e.call(i,t[a],a,t)}function r(t,e,i){for(var a=Object.keys(e),n=0;n<a.length;)(!i||i&&void 0===t[a[n]])&&(t[a[n]]=e[a[n]]),n++;return t}function o(t,e){return r(t,e,!0)}function l(t,e,i){var a,n=e.prototype;a=t.prototype=Object.create(n),a.constructor=t,a._super=n,i&&r(a,i)}function c(t,e){return function(){return t.apply(e,arguments)}}function h(t,e){return typeof t==ct?t.apply(e?e[0]||void 0:void 0,e):t}function u(t,e){return void 0===t?e:t}function d(t,e,i){s(g(e),function(e){t.addEventListener(e,i,!1)})}function p(t,e,i){s(g(e),function(e){t.removeEventListener(e,i,!1)})}function m(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function f(t,e){return t.indexOf(e)>-1}function g(t){return t.trim().split(/\s+/g)}function v(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var a=0;a<t.length;){if(i&&t[a][i]==e||!i&&t[a]===e)return a;a++}return-1}function b(t){return Array.prototype.slice.call(t,0)}function y(t,e,i){for(var a=[],n=[],s=0;s<t.length;){var r=e?t[s][e]:t[s];v(n,r)<0&&a.push(t[s]),n[s]=r,s++}return i&&(a=e?a.sort(function(t,i){return t[e]>i[e]}):a.sort()),a}function C(t,e){for(var i,a,n=e[0].toUpperCase()+e.slice(1),s=0;s<ot.length;){if(i=ot[s],a=i?i+n:e,a in t)return a;s++}}function w(){return pt++}function $(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}function k(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){h(t.options.enable,[t])&&i.handler(e)},this.init()}function T(t){var e,i=t.options.inputClass;return new(e=i?i:gt?z:vt?j:ft?R:_)(t,P)}function P(t,e,i){var a=i.pointers.length,n=i.changedPointers.length,s=e&kt&&a-n===0,r=e&(Pt|It)&&a-n===0;i.isFirst=!!s,i.isFinal=!!r,s&&(t.session={}),i.eventType=e,I(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function I(t,e){var i=t.session,a=e.pointers,n=a.length;i.firstInput||(i.firstInput=x(e)),n>1&&!i.firstMultiple?i.firstMultiple=x(e):1===n&&(i.firstMultiple=!1);var s=i.firstInput,r=i.firstMultiple,o=r?r.center:s.center,l=e.center=N(a);e.timeStamp=dt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=L(o,l),e.distance=B(o,l),D(i,e),e.offsetDirection=W(e.deltaX,e.deltaY),e.scale=r?A(r.pointers,a):1,e.rotation=r?M(r.pointers,a):0,S(i,e);var c=t.element;m(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function D(t,e){var i=e.center,a=t.offsetDelta||{},n=t.prevDelta||{},s=t.prevInput||{};e.eventType!==kt&&s.eventType!==Pt||(n=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},a=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=n.x+(i.x-a.x),e.deltaY=n.y+(i.y-a.y)}function S(t,e){var i,a,n,s,r=t.lastInterval||e,o=e.timeStamp-r.timeStamp;if(e.eventType!=It&&(o>$t||void 0===r.velocity)){var l=r.deltaX-e.deltaX,c=r.deltaY-e.deltaY,h=E(o,l,c);a=h.x,n=h.y,i=ut(h.x)>ut(h.y)?h.x:h.y,s=W(l,c),t.lastInterval=e}else i=r.velocity,a=r.velocityX,n=r.velocityY,s=r.direction;e.velocity=i,e.velocityX=a,e.velocityY=n,e.direction=s}function x(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:ht(t.pointers[i].clientX),clientY:ht(t.pointers[i].clientY)},i++;return{timeStamp:dt(),pointers:e,center:N(e),deltaX:t.deltaX,deltaY:t.deltaY}}function N(t){var e=t.length;if(1===e)return{x:ht(t[0].clientX),y:ht(t[0].clientY)};for(var i=0,a=0,n=0;e>n;)i+=t[n].clientX,a+=t[n].clientY,n++;return{x:ht(i/e),y:ht(a/e)}}function E(t,e,i){return{x:e/t||0,y:i/t||0}}function W(t,e){return t===e?Dt:ut(t)>=ut(e)?t>0?St:xt:e>0?Nt:Et}function B(t,e,i){i||(i=Mt);var a=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return Math.sqrt(a*a+n*n)}function L(t,e,i){i||(i=Mt);var a=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return 180*Math.atan2(n,a)/Math.PI}function M(t,e){return L(e[1],e[0],At)-L(t[1],t[0],At)}function A(t,e){return B(e[0],e[1],At)/B(t[0],t[1],At)}function _(){this.evEl=zt,this.evWin=Ot,this.allow=!0,this.pressed=!1,k.apply(this,arguments)}function z(){this.evEl=Ht,this.evWin=Rt,k.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=qt,this.evWin=Ut,this.started=!1,k.apply(this,arguments)}function F(t,e){var i=b(t.touches),a=b(t.changedTouches);return e&(Pt|It)&&(i=y(i.concat(a),"identifier",!0)),[i,a]}function j(){this.evTarget=Xt,this.targetIds={},k.apply(this,arguments)}function H(t,e){var i=b(t.touches),a=this.targetIds;if(e&(kt|Tt)&&1===i.length)return a[i[0].identifier]=!0,[i,i];var n,s,r=b(t.changedTouches),o=[],l=this.target;if(s=i.filter(function(t){return m(t.target,l)}),e===kt)for(n=0;n<s.length;)a[s[n].identifier]=!0,n++;for(n=0;n<r.length;)a[r[n].identifier]&&o.push(r[n]),e&(Pt|It)&&delete a[r[n].identifier],n++;return o.length?[y(s.concat(o),"identifier",!0),o]:void 0}function R(){k.apply(this,arguments);var t=c(this.handler,this);this.touch=new j(this.manager,t),this.mouse=new _(this.manager,t)}function V(t,e){this.manager=t,this.set(e)}function q(t){if(f(t,te))return te;var e=f(t,ee),i=f(t,ie);return e&&i?ee+" "+ie:e||i?e?ee:ie:f(t,Qt)?Qt:Kt}function U(t){this.id=w(),this.manager=null,this.options=o(t||{},this.defaults),this.options.enable=u(this.options.enable,!0),this.state=ae,this.simultaneous={},this.requireFail=[]}function J(t){return t&le?"cancel":t&re?"end":t&se?"move":t&ne?"start":""}function X(t){return t==Et?"down":t==Nt?"up":t==St?"left":t==xt?"right":""}function G(t,e){var i=e.manager;return i?i.get(t):t}function Y(){U.apply(this,arguments)}function Z(){Y.apply(this,arguments),this.pX=null,this.pY=null}function K(){Y.apply(this,arguments)}function Q(){U.apply(this,arguments),this._timer=null,this._input=null}function tt(){Y.apply(this,arguments)}function et(){Y.apply(this,arguments)}function it(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function at(t,e){return e=e||{},e.recognizers=u(e.recognizers,at.defaults.preset),new nt(t,e)}function nt(t,e){e=e||{},this.options=o(e,at.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=T(this),this.touchAction=new V(this,this.options.touchAction),st(this,!0),s(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function st(t,e){var i=t.element;s(t.options.cssProps,function(t,a){i.style[C(i.style,a)]=e?t:""})}function rt(t,e){var i=document.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var ot=["","webkit","moz","MS","ms","o"],lt=document.createElement("div"),ct="function",ht=Math.round,ut=Math.abs,dt=Date.now,pt=1,mt=/mobile|tablet|ip(ad|hone|od)|android/i,ft="ontouchstart"in window,gt=void 0!==C(window,"PointerEvent"),vt=ft&&mt.test(navigator.userAgent),bt="touch",yt="pen",Ct="mouse",wt="kinect",$t=25,kt=1,Tt=2,Pt=4,It=8,Dt=1,St=2,xt=4,Nt=8,Et=16,Wt=St|xt,Bt=Nt|Et,Lt=Wt|Bt,Mt=["x","y"],At=["clientX","clientY"];k.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d($(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p($(this.element),this.evWin,this.domHandler)}};var _t={mousedown:kt,mousemove:Tt,mouseup:Pt},zt="mousedown",Ot="mousemove mouseup";l(_,k,{handler:function(t){var e=_t[t.type];e&kt&&0===t.button&&(this.pressed=!0),e&Tt&&1!==t.which&&(e=Pt),this.pressed&&this.allow&&(e&Pt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Ct,srcEvent:t}))}});var Ft={pointerdown:kt,pointermove:Tt,pointerup:Pt,pointercancel:It,pointerout:It},jt={2:bt,3:yt,4:Ct,5:wt},Ht="pointerdown",Rt="pointermove pointerup pointercancel";window.MSPointerEvent&&(Ht="MSPointerDown",Rt="MSPointerMove MSPointerUp MSPointerCancel"),l(z,k,{handler:function(t){var e=this.store,i=!1,a=t.type.toLowerCase().replace("ms",""),n=Ft[a],s=jt[t.pointerType]||t.pointerType,r=s==bt,o=v(e,t.pointerId,"pointerId");n&kt&&(0===t.button||r)?0>o&&(e.push(t),o=e.length-1):n&(Pt|It)&&(i=!0),0>o||(e[o]=t,this.callback(this.manager,n,{
pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(o,1))}});var Vt={touchstart:kt,touchmove:Tt,touchend:Pt,touchcancel:It},qt="touchstart",Ut="touchstart touchmove touchend touchcancel";l(O,k,{handler:function(t){var e=Vt[t.type];if(e===kt&&(this.started=!0),this.started){var i=F.call(this,t,e);e&(Pt|It)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}});var Jt={touchstart:kt,touchmove:Tt,touchend:Pt,touchcancel:It},Xt="touchstart touchmove touchend touchcancel";l(j,k,{handler:function(t){var e=Jt[t.type],i=H.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}),l(R,k,{handler:function(t,e,i){var a=i.pointerType==bt,n=i.pointerType==Ct;if(a)this.mouse.allow=!1;else if(n&&!this.mouse.allow)return;e&(Pt|It)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Gt=C(lt.style,"touchAction"),Yt=void 0!==Gt,Zt="compute",Kt="auto",Qt="manipulation",te="none",ee="pan-x",ie="pan-y";V.prototype={set:function(t){t==Zt&&(t=this.compute()),Yt&&(this.manager.element.style[Gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return s(this.manager.recognizers,function(e){h(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),q(t.join(" "))},preventDefaults:function(t){if(!Yt){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var a=this.actions,n=f(a,te),s=f(a,ie),r=f(a,ee);return n||s&&i&Wt||r&&i&Bt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ae=1,ne=2,se=4,re=8,oe=re,le=16,ce=32;U.prototype={defaults:{},set:function(t){return r(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(n(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=G(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return n(t,"dropRecognizeWith",this)?this:(t=G(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(n(t,"requireFailure",this))return this;var e=this.requireFail;return t=G(t,this),-1===v(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(n(t,"dropRequireFailure",this))return this;t=G(t,this);var e=v(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(i.options.event+(e?J(a):""),t)}var i=this,a=this.state;re>a&&e(!0),e(),a>=re&&e(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=ce)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(ce|ae)))return!1;t++}return!0},recognize:function(t){var e=r({},t);return h(this.options.enable,[this,e])?(this.state&(oe|le|ce)&&(this.state=ae),this.state=this.process(e),void(this.state&(ne|se|re|le)&&this.tryEmit(e))):(this.reset(),void(this.state=ce))},process:function(t){},getTouchAction:function(){},reset:function(){}},l(Y,U,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,a=e&(ne|se),n=this.attrTest(t);return a&&(i&It||!n)?e|le:a||n?i&Pt?e|re:e&ne?e|se:ne:ce}}),l(Z,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:Lt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Wt&&e.push(ie),t&Bt&&e.push(ee),e},directionTest:function(t){var e=this.options,i=!0,a=t.distance,n=t.direction,s=t.deltaX,r=t.deltaY;return n&e.direction||(e.direction&Wt?(n=0===s?Dt:0>s?St:xt,i=s!=this.pX,a=Math.abs(t.deltaX)):(n=0===r?Dt:0>r?Nt:Et,i=r!=this.pY,a=Math.abs(t.deltaY))),t.direction=n,i&&a>e.threshold&&n&e.direction},attrTest:function(t){return Y.prototype.attrTest.call(this,t)&&(this.state&ne||!(this.state&ne)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),l(K,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ne)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),l(Q,U,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Kt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(Pt|It)&&!s)this.reset();else if(t.eventType&kt)this.reset(),this._timer=a(function(){this.state=oe,this.tryEmit()},e.time,this);else if(t.eventType&Pt)return oe;return ce},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===oe&&(t&&t.eventType&Pt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=dt(),this.manager.emit(this.options.event,this._input)))}}),l(tt,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ne)}}),l(et,Y,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Wt|Bt,pointers:1},getTouchAction:function(){return Z.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Wt|Bt)?e=t.velocity:i&Wt?e=t.velocityX:i&Bt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&ut(e)>this.options.velocity&&t.eventType&Pt},emit:function(t){var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),l(it,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Qt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&kt&&0===this.count)return this.failTimeout();if(n&&s&&i){if(t.eventType!=Pt)return this.failTimeout();var r=this.pTime?t.timeStamp-this.pTime<e.interval:!0,o=!this.pCenter||B(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&r?this.count+=1:this.count=1,this._input=t;var l=this.count%e.taps;if(0===l)return this.hasRequireFailures()?(this._timer=a(function(){this.state=oe,this.tryEmit()},e.interval,this),ne):oe}return ce},failTimeout:function(){return this._timer=a(function(){this.state=ce},this.options.interval,this),ce},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==oe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),at.VERSION="2.0.4",at.defaults={domEvents:!1,touchAction:Zt,enable:!0,inputTarget:null,inputClass:null,preset:[[tt,{enable:!0}],[K,{enable:!0},["rotate"]],[et,{direction:Wt}],[Z,{direction:Wt},["swipe"]],[it],[it,{event:"doubletap",taps:2},["tap"]],[Q]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var he=1,ue=2;nt.prototype={set:function(t){return r(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ue:he},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,a=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&oe)&&(n=e.curRecognizer=null);for(var s=0;s<a.length;)i=a[s],e.stopped===ue||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(t),!n&&i.state&(ne|se|re)&&(n=e.curRecognizer=i),s++}},get:function(t){if(t instanceof U)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(n(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(n(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(v(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return s(g(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return s(g(t),function(t){e?i[t].splice(v(i[t],e),1):delete i[t]}),this},emit:function(t,e){this.options.domEvents&&rt(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var a=0;a<i.length;)i[a](e),a++}},destroy:function(){this.element&&st(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},r(at,{INPUT_START:kt,INPUT_MOVE:Tt,INPUT_END:Pt,INPUT_CANCEL:It,STATE_POSSIBLE:ae,STATE_BEGAN:ne,STATE_CHANGED:se,STATE_ENDED:re,STATE_RECOGNIZED:oe,STATE_CANCELLED:le,STATE_FAILED:ce,DIRECTION_NONE:Dt,DIRECTION_LEFT:St,DIRECTION_RIGHT:xt,DIRECTION_UP:Nt,DIRECTION_DOWN:Et,DIRECTION_HORIZONTAL:Wt,DIRECTION_VERTICAL:Bt,DIRECTION_ALL:Lt,Manager:nt,Input:k,TouchAction:V,TouchInput:j,MouseInput:_,PointerEventInput:z,TouchMouseInput:R,SingleTouchInput:O,Recognizer:U,AttrRecognizer:Y,Tap:it,Pan:Z,Swipe:et,Pinch:K,Rotate:tt,Press:Q,on:d,off:p,each:s,merge:o,extend:r,inherit:l,bindFn:c,prefixed:C}),i.exports=at}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},208:function(t,e,i){var a;a=function(t){function e(t,e){var i=a(t);i.data("hammer")||i.data("hammer",new n(i[0],e))}var a=i(147),n=i(207);a.fn.hammer=function(t){return this.each(function(){e(this,t)})},n.Manager.prototype.emit=function(t){return function(e,i){t.call(this,e,i),a(this.element).trigger({type:e,gesture:i})}}(n.Manager.prototype.emit)}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},209:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(152),r=i(151),o=i(161),l=new o;l.init=function(t){this.$element=n(".btn-group-wrap"),this.$step=this.$element.children(".step"),this.currStep=1,this.source=t?t:"",this.cusDataMap={};var e=this;return this.$element.on("click",".btn",function(t){if("link"===n(this).data("type"))return!0;t.preventDefault();var i=n(this),a=s.parseNum(n(this).data("type"));if(!i.hasClass("disabled"))switch(a){case 1:e.addCart(i);break;case 2:e.save(i,function(t){location.href="/item/new?work="+t.Id});break;case 3:e.addCart(i);break;case 4:e.customAgain(i);break;case 5:e.saveChange(i);break;case 6:e.exitSave(i)}}),this},l.getCurrStep=function(){return this.currStep},l.setBtnStatus=function(t){var e=this.$step.find(".btn");return!s.isBoolean(t)&&(t=!1),t?e.addClass("disabled"):e.removeClass("disabled"),this},l.preStart=function(t){return s.isFunction(t)&&(this.preFn=t),this},l.addPromptEv=function(t){return s.isFunction(t)&&(this.prompt=t),this},l._checkData=function(t){var e=this.preFn?this.preFn():!1;if(!e||!e.picType||!e.picObj)return!1;var i,a=e.picObj,n=this,s=t.find("span").html();return(i=a.getFinalData())?i&&i.error?(n.prompt(i.error),!1):(delete i.Money,t.find("span").html("定制中...").addClass("disabled"),{picObj:a,picType:e.picType,addType:e.addType,finalData:i,btnWords:s}):(n.prompt("您的定制还没完成哦 (o⌒．⌒o)"),!1)},l.showStep=function(t){this.$step.removeClass("active"),this.$step.filter(".step"+t).addClass("active"),this.currStep=t},l.addCart=function(t){var e=this;this.save(t,function(i,a,s){return a?void(i.Conflict?(t.find("span").html(a.btnWords).removeClass("disabled"),e.prompt("很遗憾%>_<%物料冲突无法支持成品制作~不过效果这么棒，必须分享下！",5e3)):i.Output&&i.Money>0?n.post(r.cart.add,{CustomId:i.Id,Type:1},function(n){return t.find("span").html(a.btnWords).removeClass("disabled"),n&&n.Error?void("Custom can not output"==n.Error?e.prompt("很遗憾%>_<%图片太小无法支持成品制作~不过效果这么棒，必须分享下！",5e3):e.prompt(n.Error)):void(n&&(e.prompt("添加成功"),e.emit("after.addCart",i,a)))}):(t.find("span").html(a.btnWords).removeClass("disabled"),e.prompt("很遗憾%>_<%图片太小无法支持成品制作~不过效果这么棒，必须分享下！",5e3))):!1})},l.save=function(t,e){var i=this._checkData(t),a=this,o=i&&i.picObj.getCustomData("cusData");return i?o?void(s.isFunction(e)&&e(o,i)):(console.log(i),console.log(a.source),void n.ajax({contentType:"application/json;charset=utf-8",type:"POST",url:r.custom.add+i.addType+"?Source="+a.source,data:JSON.stringify(i.finalData),dataType:"JSON",success:function(n){return t.find("span").html(i.btnWords).removeClass("disabled"),n&&n.Error?void a.prompt(n.Error):void(n&&(a.showStep(n.CartId?2:3),a.emit("after.save",n,i),a.saveCusDataByType(i.picType,i.picObj),a.prompt("添加成功"),a.customAgain(),s.isFunction(e)&&e(n,i)))},error:function(e){a.prompt(e.responseText),t.find("span").html(i.btnWords).removeClass("disabled")}})):!1},l.customAgain=function(){var t=this.preFn?this.preFn():!1;return t&&t.picType&&t.picObj?(this.emit("after.customAgain",t),this.cusDataMap[t.picType]=null,void this.showStep(1)):!1},l.exitSave=function(){var t,e=this.preFn?this.preFn():!1;if(!e||!e.picType||!e.picObj)return!1;var i=e.picObj.getCustomData("cusData");t=i?i.CartId?2:3:1,this.showStep(t),this.cusDataMap[e.picType]&&(this.cusDataMap[e.picType].initData.step=t),this.emit("after.exitSave",this.cusDataMap[e.picType])},l.saveChange=function(t){var e=this._checkData(t),i=this;if(!e)return!1;var a=e.picObj.getCustomData("cusData");return a?void n.ajax({contentType:"application/json;charset=utf-8",type:"POST",url:r.custom.update+"/"+a.Id,data:JSON.stringify(e.finalData),dataType:"JSON",success:function(a){return t.find("span").html(e.btnWords).removeClass("disabled"),a&&a.Error?void i.prompt(a.Error):void(a&&(i.prompt("保存成功"),i.showStep(a.CartId?2:3),i.emit("after.save",a,e),i.saveCusDataByType(e.picType,e.picObj)))},error:function(a){i.prompt(a.responseText),t.find("span").html(e.btnWords).removeClass("disabled")}}):(i.prompt("cusData is undefined"),t.find("span").html(e.btnWords).removeClass("disabled"),!1)},l.saveCusDataByType=function(t,e){this.cusDataMap[t]={picType:t,markName:e.markName,initData:n.extend(!0,{},e.getCustomData())}},a.exports=l}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},210:function(t,e,i){var a;a=function(t,e,a){function n(t){if(t&&!(t.length<=0)){var e=null,i=null;t.each(function(){e=r(this),r(this).hasClass("stat-load")||!function(t){i={imgSrc:t.data("img"),$img:t.find("img"),$item:t},s(i)}(e)})}}function s(t,e,i){t.imgSrc&&t.$img&&t.$item&&o.onImgEvent(t.imgSrc,function(i){var a,n,s=i.width,l=i.height,c=r(i);s>l?(a=g,n=l*g/s):l>s?(n=g,a=s*g/l):(a=g,n=g),t.$img.css({width:a,height:n}).attr("src",c.attr("src")),t.$item.addClass("stat-load").removeClass("pre-item"),o.isFunction(e)&&e()},function(){t.$item.addClass("stat-error").removeClass("pre-item"),o.isFunction(i)&&i()})}i(185),i(146);var r=i(147),o=i(152),l=i(151),c=i(161),h=i(211),u=i(212),d=i(203),p=i(213),m=new EJS({url:"/src/tpl/custom/work&scene/list-tpl"}),f=new EJS({url:"/src/tpl/custom/work&scene/list-item-tpl"}),g=160,v=l.custom.picture,b=l.bom.bomIcon,y=!1,C=null,w=510,$=180,k=540,T=new c;T.status=!1,T.TRANSITION_DURATION=800,T.SLIDE_TRANSITION_DURATION=600,T.PAGELIST_TRANSITION_DURATION=300,T.on("scene.getPic",function(t){C=t}),T.on("close",function(t){if(this.$ele.hasClass("active")){this.emit("slide.off");var e=T.$tabnav.find("li.active").data("type");"scene"===e?u.emit("close",t):o.isFunction(t)&&t()}else u.emit("close",t)}),T.on("slide.off",function(){var t=this;this.slide(0,function(){t.$tabnav.find("li.active").removeClass("active"),t.$ele.removeClass("active")})}),T.on("selectWork",function(t){var e=T.$tabnav.find("li.active"),i=(e.data("type"),T.$work.find(".work-list").children(".item"));i.filter(".active").removeClass("active"),i.filter("[data-id="+t+"]").addClass("active")}),T.init=function(){this.$ele=r("#ws-area"),this.$parent=this.$ele.parent(),this.$tabnav=this.$ele.children(".tab-nav"),this.$paneWrap=this.$ele.find(".pane-wrap"),this.$tabContWrap=this.$ele.children(".tab-content-wrap"),this.$work=r("#work-area"),this.$scene=r("#scene-area"),this.$work.data("page",1),this.$scene.data("page",1),this.currType=null,this._regPageEv();var t=this;u.init(),u.on("close.done",function(){t.$scene.find(".item.active").removeClass("active"),t.emit("slide.off"),t.status=!1});var e=null,i=!1,a=null,s=0,l=0,c=!1;d.download(1,function(){e&&clearTimeout(e),e=setTimeout(function(){t.emit("work.click","1463")})},function(t){console.error(t)}),this.$ele.on("click",".tab-nav li a",function(i){i.preventDefault();var a,s=r(this),l=r(this).parent(),c=l.data("type"),h=null,f=!1;if(s.hasClass("disabled"))return t.emit("prompt.error","此品类不支持实景展示"),!0;if(l.hasClass("active"))return void t.emit("slide.off");switch(t.$ele.hasClass("active")||t.slide($),t.$ele.addClass("active"),t.$tabContWrap.addClass("loading"),c){case"work":t.$tabContWrap.removeClass("no-page"),t.$scene.find(".item.active").removeClass("active"),a=t.$work.data("page"),f=!0,d.download(a,function(){var i=t.activeWorkEv(),s=d.getData(a),r=m.render({data:s,url:v,type:"work",id:i});t.$work.children().remove(),t.$work.append(r),s&&s.length>0?(t.showTips("work",!1),n(t.$work.find(".cont-list").children())):t.showTips("work",!0),t.$tabContWrap.removeClass("loading"),u.emit("close",function(){e&&clearTimeout(e),e=setTimeout(function(){t.emit("work.click","1454")})})},function(t){console.error(t)});break;case"scene":t.$tabContWrap.addClass("no-page");var g=o.isFunction(t.preEv)&&t.preEv();if(!g)return void console.error("currPicType is undefined");h=p.getData(g),(!h||h.length<=0)&&(f=!0,p.download(g,function(){var e=p.getData(g),i=m.render({data:e,url:b,type:"scene",id:0});t.$scene.children().remove(),t.$scene.append(i),e&&e.length>0?n(t.$scene.find(".cont-list").children()):t.showTips("scene",!0),t.$tabContWrap.removeClass("loading")},function(t){console.error(t)}));break;default:return}t.currType=c,s.tab("show"),!f&&t.$tabContWrap.removeClass("loading")}),this.$ele.on("click",".tab-cont-item .cont-list li",function(i){if(!r(this).hasClass("active")){var a=r(this).data("type"),n=o.parseNum(r(this).data("id"));if(r(this).siblings(".active").removeClass("active"),r(this).addClass("active"),"work"==a)u.emit("close",function(){e&&clearTimeout(e),e=setTimeout(function(){t.emit("work.click",n)})});else if("scene"==a){var s=o.isFunction(t.preEv)&&t.preEv();if(!s)return void console.error("currPicType is undefined");t.emit("before.scene");var l=p.getById(s,n);t.status=!0,u.setData(l,C)}}}),this.$work.on("click",".item .ww-close",function(e){e.stopPropagation();var i=r(this).closest("li.item"),a=i.data("id"),n=i.data("cart"),s=0==n?"":'<p class="color-d1">将同时从购物车中移除</p>';h.confirm("确认要删除此作品吗？",function(){d.removeFormServer(a,function(e){if(t.emit("del.work.ok",{id:a,cartId:n}),0==i.siblings(".item").length){var s,r=t.$work.data("page");if(r>1)s=r-1;else{if(!(d.getTotalPage()>1))return void t.showTips("work",!0);s=1}t.loadList("work",s,function(){t.setPageNum(s)})}else i.remove()},function(e){t.emit("del.work.fail",e)})},s+'<img src="'+i.data("img")+'" />')}),this.$paneWrap.on("mouseenter",function(e){e.preventDefault(),a=t["$"+t.currType],s=isNaN(a.data("offset"))?0:o.parseNum(a.data("offset"));var n=a.height();l=n-k,l>0&&(i=!0)}).on("mousewheel DOMMouseScroll MozMousePixelScroll",function(t){if(t.preventDefault(),t.stopPropagation(),i&&a&&!c){var e,n=t.originalEvent.wheelDelta||-t.originalEvent.detail,r=Math.abs(s);if(n>0){if(0==s)return;e=r-w>0?w:r,s+=e}else{if(l==r)return;e=l-r-w>0?w:l-r,s-=e}c=!0,a.animate({top:s+"px"},500,function(){c=!1}),a.data("offset",s)}}).on("mouseleave",function(){i=!1,a=null})},T.addPreEv=function(t){o.isFunction(t)&&(this.preEv=t)},T._regPageEv=function(){this.$pageWrap=this.$ele.find(".page-wrap"),this.$prev=this.$pageWrap.find(".item.prev"),this.$next=this.$pageWrap.find(".item.next"),this.$pageNum=this.$pageWrap.find(".item.mid-item span"),this.$pageList=this.$pageWrap.find(".page-list ul");var t=this;this.$pageWrap.on("click",">.item",function(e){e.preventDefault(),e.stopPropagation();var i=r(this),a=r(this).data("type"),n=null;if(t.currType&&("work"===t.currType||"scene"===t.currType)&&"scene"!==t.currType&&!r(this).hasClass("disabled")){n=t["$"+t.currType];var s,o=n.data("page"),l=!1;switch(a){case"prev":if(t.$pageWrap.removeClass("open"),1>=o)return;s=o-1,l=!0,r(this).addClass("disable");break;case"next":if(t.$pageWrap.removeClass("open"),o>=d.getPager().TotalPage)return;s=o+1,l=!0,r(this).addClass("disable");break;default:return}l&&t.loadList(t.currType,s,function(){t.setPageNum(s),i.removeClass("disable")})}}),this.$pageList.on("click","li",function(e){e.stopPropagation(),e.preventDefault();var i=r(this),a=r(this).data("num");t.loadList("work",a,function(){i.addClass("active"),i.siblings(".active").removeClass("active"),t.setPageNum(a)})}),this.$pageNum.parents(".mid-item").hover(function(){t.$pageWrap.addClass("open");var e=t.$work.data("page"),i=d.getPager().TotalPage,a="",n=null;t.$pageList.children().remove();for(var s=0;i>s;s++)a+='<li data-num="'+(s+1)+'" >第 '+(s+1)+" 页</li>";t.$pageList.append(a),n=t.$pageList.find("li[data-num="+e+"]"),n.addClass("active")},function(){r.support.transition?(t.$pageWrap.addClass("close-page"),t.$pageList.one("bsTransitionEnd",function(){t.$pageWrap.removeClass("open close-page")}).emulateTransitionEnd(t.PAGELIST_TRANSITION_DURATION)):t.$pageWrap.removeClass("open")})},T.loadList=function(t,e,i){if(t&&("work"===t||"scene"===t)){var a=this,s=null,r=null,l=null;this.$tabContWrap.addClass("loading"),"work"===t?(l=this.$work,r=l.find(".cont-list"),l.css("top","0"),l.data("offset",0),d.download(e,function(){if(s=d.getData(e),s&&s.length>0){var t=a.activeWorkEv?a.activeWorkEv():-1,c=f.render({data:s,url:v,type:"work",id:t});l.data("page",e),r.children().remove(),r.append(c),a.showTips("work",!1),a.$tabContWrap.removeClass("loading"),n(r.children(".pre-item")),o.isFunction(i)&&i()}else a.$tabContWrap.removeClass("loading"),a.showTips("work",!0),o.isFunction(i)&&i()},function(t){console.error(t),a.$tabContWrap.removeClass("loading")})):"scene"===t&&(l=this.$scene)}},T.slide=function(t,e){var i=this,a=this.$parent;y||(r.support.transition?(a.css({"-webkit-transform":"translate3d("+t+"px, 0, 0)","-moz-transform":"translate3d("+t+"px, 0, 0)","-ms-transform":"translate3d("+t+"px, 0, 0)",transform:"translate3d("+t+"px, 0, 0)"}),a.offsetWidth,a.one("bsTransitionEnd",function(){o.isFunction(e)&&e(),y=!1}).emulateTransitionEnd(i.SLIDE_TRANSITION_DURATION)):(i.status=!!t,a.css("left",t+"px"),o.isFunction(e)&&e(),y=!1))},T.setPageNum=function(t){this.$pageNum.html(t)},T.initPageBtnStatus=function(){var t=this.$work.data("page"),e=d.getPager().TotalPage;this.$prev.removeClass("disabled"),this.$next.removeClass("disabled"),1===e?(this.$prev.addClass("disabled"),this.$next.addClass("disabled")):(1===t&&this.$prev.addClass("disabled"),t===e&&this.$next.addClass("disabled"))},T.setWorkCartId=function(t,e){this.$work.find(".work-list").children(".item[data-id="+t+"]").data("cart",e)},T.reloadWorkList=function(){var t=this.$work.data("page");1===t&&this.loadList("work",1)},T.showTips=function(t,e){var i=null;"work"===t?i=this.$work:"scene"===t&&(i=this.$scene),i&&(i.toggleClass("no",e),e&&this.$tabContWrap.addClass("no-page"))},T.addActiveWorkEv=function(t){o.isFunction(t)&&(this.activeWorkEv=t)},T.getActiveNav=function(){return this.$ele.hasClass("active")?this.$tabnav.find(".active").data("type"):!1},T.clear=function(t){"work"===t?this.$work.find(".work-list .item.active").removeClass("active"):"scene"===t&&this.$scene.find(".scene-list .item.active").removeClass("active")},a.exports=T}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},211:function(t,e,i){var a;a=function(t,e,a){i(146);var n=i(147),s='<div class="ww-dialog"></div>',r={confirm:'<div class="dialog confirm"><h2 class="msg"></h2><div class="msg-detail"></div><div class="dialog-btn"><button type="button" class="btn btn-default btn-lg mr10" data-confirm="dialog">确认</button><button type="button" class="btn btn-default btn-lg" data-dismiss="dialog">取消</button></div></div>'},o=300,l={$body:n(document.body),$dialogWrap:null,mapDialog:{},currDialog:null,$backdrop:null,show:function(){this.currDialog&&(this.$dialogWrap.on("click.dismiss.ww.dialog",'[data-dismiss="dialog"]',n.proxy(this.hide,this)),this.$backdrop||(n('<div class="dialog-overlay"></div>').prependTo(this.$dialogWrap),this.$backdrop=this.$dialogWrap.find(".dialog-overlay")),this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.$dialogWrap.addClass("dialog-open"))},hide:function(){var t=this;this.$dialogWrap.off("click.dismiss.ww.dialog",'[data-dismiss="dialog"]'),this.$dialogWrap.off("click.confirm.ww.dialog",'[data-confirm="dialog"]'),n.support.transition?(this.$dialogWrap.addClass("dialog-close"),this.currDialog.one("bsTransitionEnd",function(e){t.currDialog=null,t.$dialogWrap.removeClass("dialog-open dialog-close"),t.$body.removeClass("modal-open"),t.resetScrollbar()}).emulateTransitionEnd(o),t.currDialog[0].offsetWidth):(t.$dialogWrap.removeClass("dialog-open"),t.$body.removeClass("modal-open"),t.resetScrollbar())},confirm:function(t,e,i){if(this.currDialog=this.getDialog("confirm"),this.currDialog.find(".msg").html(t),this.$dialogWrap.on("click.confirm.ww.dialog",'[data-confirm="dialog"]',n.proxy(function(t){this.hide(),e()},this)),i){var a=this.currDialog.find(".msg-detail");a.children().remove(),a.append(i)}this.show()},getDialog:function(t){return this.$dialogWrap||(this.$body.append(s),this.$dialogWrap=this.$body.find(".ww-dialog")),r[t]?(this.mapDialog[t]||(this.$dialogWrap.append(r[t]),this.mapDialog[t]=this.$dialogWrap.find(".dialog."+t)),this.mapDialog[t]):void 0},checkScrollbar:function(){this.scrollbarWidth=this.measureScrollbar()},setScrollbar:function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",t+this.scrollbarWidth)},resetScrollbar:function(){this.$body.css("padding-right","")},measureScrollbar:function(){if(document.body.clientWidth>=window.innerWidth)return 0;var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e}};a.exports=l}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},212:function(t,e,i){var a;a=function(t,e,a){i(185),i(146);var n=i(147),s=(i(150),i(152)),r=i(161),o=i(164),l=i(151),c=l.bom.bomIcon,h=!1,u=null,d=610,p=550,m=new r;m.SLIDE_TRANSITION_DURATION=300,m.on("done",function(){this.$ele.removeClass("holder"),this.load=!1}),m.on("close",function(t){this.picData=null,this.obj=null,this.currPicObj=null,h=!1;var e=this;this.$parent.hasClass("scene")?this.slide(-d,function(){e.$parent.removeClass("scene"),e.emit("close.done"),s.isFunction(t)&&t()}):s.isFunction(t)&&t()}),m.init=function(){this.$parent=n(".custom-cont"),this.$ele=this.$parent.find(".scene-area"),this.$bgImg=this.$ele.find(".scene-bg"),this.$picWrap=this.$ele.find(".scene-pic-wrap"),this.$picItem=this.$picWrap.find(".pic-item"),this.picMap={};var t,e,i=null,a=this;this.$ele.on("mousedown",".pic-item, .box",function(a){a.stopPropagation(),a.preventDefault(),i=n(this),"photoWall"!==n(this).data("type")?n(this).addClass("grab grabbing"):n(this).addClass("moving"),t=a.clientX,e=a.clientY}).on("mousemove",".pic-item, .box",function(a){a.stopPropagation(),a.preventDefault();var n,r;if(i){n=a.clientX-t,r=a.clientY-e,t=a.clientX,e=a.clientY;var o=s.getOffsetByType(i,["top","left"]),l=null;o&&(l={top:o.top+r,left:o.left+n}),l&&i.css(l)}}).on("mouseup",".pic-item, .box",function(t){t.preventDefault(),i&&(i=null,n(this).removeClass("grabbing moving"))}).on("mouseleave",".pic-item, .box",function(t){t.preventDefault(),i&&(i=null,n(this).removeClass("grabbing moving"))}),this.$ele.on("click",".scene-close",function(t){t.stopPropagation(),a.emit("close")})},m.setBg=function(t){if(!t||!t.Backdrop)return!1;var e,i,a=this,r=.85*this.$parent.width(),o=c+t.Backdrop;e=r,i=r*t.Height/t.Width,i>p&&(i=p,e=p*t.Width/t.Height),h||(n.support.transition?this.$ele.css({"-webkit-transform":"translate3d(0, "+-d+"px, 0)","-moz-transform":"translate3d(0, "+-d+"px, 0)","-ms-transform":"translate3d(0, "+-d+"px, 0)",transform:"translate3d(0, "+-d+"px, 0)"}):this.$ele.css("top",-d+"px"),h=!0),this.$parent.addClass("loading scene"),this.load=!0,this.sceneRate=e/t.Width,this.$ele.addClass("pre");var l,m,f=this.currPicObj,g=f.getCustomData("size"),v=null;switch(f.markName){case"framePic":case"multiHolePic":l=f.getCustomData("line"),v={width:this.sceneRate*(g.Width+2*l.Properties.Bottom),height:this.sceneRate*(g.Height+2*l.Properties.Bottom)};break;case"rimlessFramePic":l=f.getCustomData("outerLine"),v={width:this.sceneRate*(g.Width+2*l.Properties.Top),height:this.sceneRate*(g.Height+2*l.Properties.Top)};break;case"scrollPic":m=f.getCustomData("template"),v={width:this.sceneRate*m.Properties.Width,height:this.sceneRate*m.Properties.Height};break;case"photoWall":case"paintPic":v={width:this.sceneRate*g.Width,height:this.sceneRate*g.Height};break;default:return}this.$picWrap.children(".pic-item").css({top:s.getInt(this.sceneRate*t.Top-v.height/2),left:s.getInt(this.sceneRate*t.Left-v.width/2)}),s.onImgEvent(o,function(){a.$bgImg.attr("src",o),a.$ele.css({width:e,height:i}),a.$parent.removeClass("loading"),h?a.slide(0,function(){a.$ele.removeClass("pre"),a.$ele.addClass("holder"),u&&clearTimeout(u),u=setTimeout(function(){f.transform(v)},200)}):(a.$ele.removeClass("pre"),a.$ele.addClass("holder"),u&&clearTimeout(u),u=setTimeout(function(){f.transform(v)},200))})},m.setData=function(t,e){this.load||(this.picData=e,this.setPicObj(e),this.setBg(t))},m.setPicObj=function(t){if(!t)return!1;var e=null,i=this;if(this.$picItem.children().remove(),this.$picItem.attr("class","pic-item").attr("style",""),this.$picItem.data("type",t.markName),"photoWall"===t.markName?this.$picItem.addClass("pw-item"):"scrollPic"===t.markName&&this.$picItem.addClass("scrollPic-wrap"),this.picMap[t.markName])e=this.picMap[t.markName];else{var a={noEv:!0,needMargin:!1};e=o.create("rimlessPic"===t.markName?"paintPic":t.markName,this.$picItem,"paintPic"===t.markName?n.extend({},a,{spacer:!0}):a),e.on("transform.done",function(){i.emit("done")})}return e&&e.setCustomData(t.customData,!0),this.currPicObj=e,e},m.slide=function(t,e){var i=this,a=this.$ele;n.support.transition?(a.css({"-webkit-transform":"translate3d(0, "+t+"px, 0)","-moz-transform":"translate3d(0, "+t+"px, 0)","-ms-transform":"translate3d(0, "+t+"px, 0)",transform:"translate3d(0, "+t+"px, 0)"}),a.offsetWidth,a.one("bsTransitionEnd",function(){s.isFunction(e)&&e()}).emulateTransitionEnd(i.SLIDE_TRANSITION_DURATION)):(a.css("top",t+"px"),s.isFunction(e)&&e())},a.exports=m}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},213:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(163),r=i(150),o=i(151),l=s.WORKPAGESIZE;a.exports={data:{},download:function(t,e,i){if(!t)return!1;var a=this;return a.checkInit(t)?(r.isFunction(e)&&e(),!0):void n.getJSON(o.scene.getList+t,function(n){return n&&n.Error?void(r.isFunction(i)&&i(n.Error)):void(n&&(a.init(t,n),r.isFunction(e)&&e()))}).error(function(t){r.isFunction(i)&&i(t.responseText)})},init:function(t,e){return t?void(this.data[t]=e||[]):!1},checkInit:function(t){return this.data[t]&&this.data[t].length>0},getData:function(t,e){var i=this.data[t],a=[];if(!i)return!1;if(e)for(var n=(e-1)*l,s=e*l;s>n&&i[n];n++)a.push(i[n]);else a=i.slice();return a},getById:function(t,e){var i=this.data[t],a=null;return i?(r.every(i,function(t){return t&&t.Id==e?(a=t,!1):!0}),a):!1},getTotalPage:function(t){return this.data[t]?this.data[t].length:0}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},214:function(t,e,i){var a;a=function(t,e,a){function n(t,e){var i=e||t.getCurrPageNum(),a=null,n=t.getType(),r=k.getPicObj(),o=k.getActiveDataIds(r.getCustomData());
if("image"===n)h.download(i,function(){var t=h.getData(i);l.isArray(t)&&t.length>0&&(s(y,h.getPager().TotalPage),y.resetList(t,o.image),k.emit("load.done","image"))},function(t){k.emit("image.loadNewList.error",t)});else{var c=(i-1)*g,u=i*g;"single"===n?n="mat":"multi"===n&&(n="multiMat"),a=k.model.getList(c,u,n),s(t),t.resetList(a,o[n]),k.emit("load.done",n)}}function s(t,e){var i=t.$paginationWrap.find(".ctr-label.prev"),a=t.$paginationWrap.find(".ctr-label.next"),n=t.getCurrPageNum();i.removeClass("disable"),a.removeClass("disable"),1==n&&i.addClass("disable"),n==e&&a.addClass("disable"),e&&t.$totalPage.html(n+"/"+e)}var r=i(147),o=i(150),l=i(152),c=i(161),h=i(188),u=i(202),d=i(151),p=i(211),m=i(215),f=i(163),g=f.BOMPAGESIZE,v=d.bom.bomIcon,b=d.image.show,y=null,C=i(216),w={image:i(217),size:i(218),rimLine:i(219),mat:i(220),spacer:i(221),line:C.line,paper:C.paper,canvas:C.canvas,scrollTpl:C.scrollTpl,cupTpl:C.cupTpl,bolsterTpl:C.bolsterTpl,shirtTpl:C.shirtTpl,bagTpl:C.bagTpl,tplCanvas:C.tplCanvas,template:C.template,glass:C.glass},$={bomNav:new EJS({url:"/src/tpl/custom/aside/bom-nav-tpl"}),image:new EJS({url:"/src/tpl/custom/aside/image-tpl"}),mat:new EJS({url:"/src/tpl/custom/aside/mat-tpl"}),rimLine:new EJS({url:"/src/tpl/custom/aside/rimLine-tpl"}),size:new EJS({url:"/src/tpl/custom/aside/size-tpl"}),icon:new EJS({url:"/src/tpl/custom/aside/fullpane-icon-tpl"}),text:new EJS({url:"/src/tpl/custom/aside/fullpane-text-tpl"}),spacer:new EJS({url:"/src/tpl/custom/aside/spacer-tpl"})};m.on("add.img",function(t){t&&h.addNewImg(t)}),m.on("upload.filesAdded.error",function(t){}),m.on("upload.done",function(){n(w.image)}),m.on("select.matType",function(t,e){k.emit("select.matType",e);var i;if("single"==e)i=k.tidyMatIdArr(k.getActiveData("mat"));else if("multi"==e){var a=k.getActiveData("multiMat");i=a&&[a.Id]}i&&l.isFunction(t)&&t(i)}),m.on("set.matSite",function(t){1==t.type&&(t.mat=k.getBomData("mat",t.id,t.idx-1)),k.emit("set.matSite",t)}),m.on("getData",function(t,e){var i=k.getActiveData(t);l.isFunction(e)&&e(i)}),m.on("after.setSpacer",function(t){k.emit("after.setSpacer",t)}),m.on("select.rimLine",function(t,e){k.emit("select.rimLine",t);var i,a=null;"innerLine"===t?a=k.getActiveData("innerLine"):"outerLine"===t&&(a=k.getActiveData("outerLine")),i=a&&a.Id,l.isFunction(e)&&e(i)});var k=new c;k.on("after.setSize",function(){var t=this,e=this.getActiveNav();"size"===e&&w.size.getState()&&t.triggerNav("size"),"spacer"===e&&w.spacer.getState()&&w.spacer.reset()}),k.init=function(){this.$navWrap=r(".bom-list-nav"),this.$contWrap=r("#material-wrap"),this.$imgNav=r("#img-material-nav"),this._regEv()},k.flash=function(t,e,i){this.markName=e,this.model=i,this.$imgNav.siblings(".bom-item").remove();var a=$.bomNav.render({data:t});this.$imgNav.after(a),this.$imgNav.siblings(".bom-item").last().children("a").addClass("last");var n=h.getData(),s=this;return!n||n.length<=0?void h.download(1,function(){s.triggerNav("image")}):void this.triggerNav("image")},k._regEv=function(){var t=this.$contWrap,e=this;e.$navWrap.on("click","li a",function(t){t.preventDefault();var i,a=r(this),n=r(this).attr("href").slice(1),s=null,c=e.getPicObj(),d=c.markName,p=e.getActiveDataIds(c.getCustomData());if(w[n].getState()){var m,f=null;switch(n){case"image":"multiHolePic"!==d&&"photoWall"!==d||w.image.clear(),w.image.setActiveItem(p.image);break;case"size":if(p.multiMat){var C=w.size.isExistSize(p.size);C&&w.size.setActiveItem(p.size,2),w.size.showMultiSize(p.size,!C)}else{var k=w.size.getSource();c.isSub?i="photoWall":"framePic"===d||"multiHolePic"===d?i="frame":"rimlessPic"===d||"rimlessFramePic"===d?i="rimless":"scrollPic"===d?i="scroll":"paintPic"===d&&(i="paint"),k===i?(w.size.showRegularSize(p.size),p.mat&&0!==p.mat.length||w.size.activeSize(1),w.size.setActiveItem(p.size,1)):(w.size.setSource(i),w.size.resetRegularList(u.getData(),p.size))}break;case"mat":w.mat.resetList("multi",e.model.getList(0,g,"multiMat"),p.multiMat);var T=e.model.getList(0,g,"mat");T&&T[0].length>0&&o.each(["top","middle","bottom"],function(t,e){w.mat.resetList("single",T[e],p.mat&&p.mat[e],t)}),w.mat.selectStyle(c.isSub),p.multiMat?w.mat.showPanelByType("multi"):(e.model.checkMatData()||w.mat.forbidSingleMat(),w.mat.showPanelByType("single",p.mat),!c.isSub&&p.mat.length<=0&&e.model.checkMatData()&&w.mat.changeBtnState(!0));break;case"line":case"glass":case"paper":case"canvas":f=e.model.getList(0,g,n),m=e.model.getTotalPage(g,n),w[n].resetList(f,"paintPic"!==d||"paper"!==n&&"canvas"!==n?p[n]:p.texture),w[n].updatePagination(m);break;case"rimLine":p.outerLine&&p.innerLine?(w.rimLine.setActiveItem("outerLine",p.outerLine),w.rimLine.showPanelByType("outerLine")):p.innerLine&&(w.rimLine.setActiveItem("innerLine",p.innerLine),w.rimLine.showPanelByType("innerLine"));break;case"tplCanvas":f=e.model.getCanvasByTpl(c.getCustomData("template")),w.tplCanvas.resetList(f,p.canvas);break;case"spacer":w.spacer.setVal(p.spacer,p.size)}}else{var P,I,D,S=null,x=null;switch(n){case"image":console.log(b),s={id:p.image,type:n,data:h.getData(),totalPage:h.getPager().TotalPage,url:b},I=p.image,x=$.image;break;case"mat":s={type:n,data:[],totalPage:0,url:v,multiMat:{data:[],totalPage:e.model.getTotalPage(g,"multiMat")}},I=p.multiMat?"multi":"single",x=$.mat;break;case"rimLine":S={data:e.model.getList(0,g,"outerLine"),totalPage:e.model.getTotalPage(g,"outerLine")},s={iid:p.innerLine,oid:p.outerLine,type:n,data:e.model.getList(0,g,"innerLine"),totalPage:e.model.getTotalPage(g,"innerLine"),url:v,outerLine:S},I=p.outerLine?"outerLine":"innerLine",x=$.rimLine;break;case"size":c.isSub?i="photoWall":"framePic"===d||"multiHolePic"===d?i="frame":"rimlessPic"===d||"rimlessFramePic"===d?i="rimless":"scrollPic"===d?i="scroll":"paintPic"===d&&(i="paint"),s={source:i,id:p.size,type:n,data:u.getData(),isFrame:"framePic"===c.markName&&p.mat&&p.mat.length>0},I=p.size,x=$.size,D=p.multiMat?2:1;break;case"scrollTpl":var N=[];o.each(e.model.getList(0,g,"template"),function(t){t.hasOwnProperty("IsValid")?t.IsValid&&N.push(t):(t.IsValid=!0,N.push(t))}),s={id:p.template,type:n,data:N,totalPage:e.model.getTotalPage(g,"template"),url:v},x=$.icon;break;case"cupTpl":case"bolsterTpl":case"shirtTpl":case"bagTpl":var N=[];o.each(e.model.getList(0,g,"template"),function(t){t.hasOwnProperty("IsValid")?t.IsValid&&N.push(t):(t.IsValid=!0,N.push(t))}),s={id:p.template,type:n,data:N,totalPage:e.model.getTotalPage(g,"template")},x=$.text;break;case"tplCanvas":var E=e.model.getCanvasByTpl(c.getCustomData("template"));s={id:p.canvas,type:n,data:E,totalPage:l.getCeil(E.length/g)},x=$.text;break;case"spacer":x=$.spacer;break;default:s={id:"paintPic"!==d||"paper"!==n&&"canvas"!==n?p[n]:p.texture,type:n,data:e.model.getList(0,g,n),totalPage:e.model.getTotalPage(g,n),url:v},x="glass"===n||"canvas"===n||"paper"===n||"tplCanvas"===n?$.text:$.icon}if(x&&(P=x.render(s)),"size"===n?(e.$contWrap.find("#size").remove(),e.$contWrap.append(P)):e.$contWrap.append(P),w[n].init(r("#"+n),I,D),"size"===n&&p.multiMat&&w.size.showMultiSize(p.size,!0),"mat"===n||"spacer"===n)return void a.trigger("click")}y=w[n],r(this).tab("show")}),t.on("click",".item",function(t){t.stopPropagation(),t.preventDefault();var i=r(this),a=r(this).data("id"),n=y.getType(),s=e.getPicObj(),o=null;if(!r(this).hasClass("active")&&!r(this).hasClass("forbid")){switch(n){case"image":o=h.getImgById(a);break;case"size":o={Width:i.data("width"),Height:i.data("height"),Mat:1==i.data("mat")};break;case"single":var l,c=w.mat.getCurrSite();switch(c){case"top":l=0;break;case"middle":l=1;break;case"bottom":l=2}o={mat:e.model.getBomById(a,"mat",l),siteIdx:l,siteName:c},n="mat";break;case"multi":n="multiMat",o=e.model.getBomById(a,"multiMat");break;case"template":o=e.model.getBomById(a,n);break;case"tplCanvas":o=e.model.getBomById(a,"canvas");break;default:o=e.model.getBomById(a,n)}("multiHolePic"!==s.markName&&"photoWall"!==s.markName||"image"!==n)&&(i.siblings(".active").removeClass("active"),i.addClass("active")),e.emit("click.item",n,o,e)}}),t.on("click",".ctr-label",function(t){if(t.preventDefault(),t.stopPropagation(),!r(this).hasClass("disable")){var i,a=(r(this),r(this).siblings(".form-control")),n=l.parseNum(a.val()),o=e.getPicObj(),c=e.getActiveDataIds(o.getCustomData());r(this).hasClass("next")&&n>=1?i=n+1:r(this).hasClass("prev")&&n>=2&&(i=n-1),a.val(i);var u=y.getType();if("mat"===u);else if("rimLine"===u);else if("image"===u)h.download(i,function(){var t=h.getData(i);l.isArray(t)&&t.length>0&&(s(y,h.getPager().TotalPage),y.resetList(t,c.image),e.emit("load.done","image"))},function(t){e.emit("image.loadNewList.error",t)});else{var d=(i-1)*g,p=i*g,m=e.model.getList(d,p,u);s(y),y.resetList(m,c[u]),e.emit("load.done",u)}}}),t.on("click",".ope-group .ct-i",function(t){t.preventDefault(),t.stopPropagation();var i=r(this),a=i.closest(".item"),s=i.data("type"),o=a.data("id");if("2"==s){var l=a.data("id"),c=a.data("image");p.confirm("确认要删除这张图片吗？",function(){h.removeFormServer(l,function(t){if(0==a.siblings(".item").length){var i=w.image.getCurrPageNum();i>1?(y.$pageNumInput.val(i-1),n(y,i-1)):h.getTotalPage()>1&&(y.$pageNumInput.val(1),n(y,1))}a.remove(),e.emit("del.image.done",l)},function(t){e.emit("del.image.fail",t)})},'<img src="'+c+'" />')}if("1"==s){var u,d=y.getType(),m=null;"single"===d&&(u=y.switchSite2Idx(y.getCurrSite()),d="mat"),m=e.model.getBomById(o,d,u),e.emit("show.bomDetail",m)}}),t.on("keydown",function(t){-1!==r.inArray(t.keyCode,[46,8,9,27,13,110,190])||65==t.keyCode&&t.ctrlKey===!0||t.keyCode>=35&&t.keyCode<=40||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()}).on("keypress",".center input",function(t){13==t.which&&n(y)})},k.addGetPicObjEv=function(t){l.isFunction(t)&&(this.getPicObj=t)},k.getActiveData=function(t){var e=this.getPicObj();return e.getCustomData(t)},k.getBomData=function(t,e,i){return this.model.getBomById(e,t,i)},k.tidyMatIdArr=function(t){var e=[];return t&&t.length>0&&o.every(t,function(t){return t?(e.push(t.Id),!0):!1}),e},k.getActiveDataIds=function(t){var e=null,i=null;if(t){e={};for(var a in t)if(t.hasOwnProperty(a)&&t[a])switch(i=t[a],a){case"image":e.image=l.isArray(i)?-1:i.Rand;break;case"mat":e.mat=this.tidyMatIdArr(i);break;case"size":e.size=i;break;case"spacer":e.spacer=i;break;default:e[a]=i.Id}}return e},k.clearImg=function(){w.image.clear()},k.triggerNav=function(t){var e=this.$navWrap.find("li a[href=#"+t+"]");if(e.length>0){var i=e.parent();if(i.hasClass("active")){if("image"===t){var a=this.getActiveData("image");return void(l.isArray(a)?w.image.clear():w.image.setActiveItem(a&&a.Rand))}i.removeClass("active"),e.trigger("click")}else i.removeClass("active"),e.trigger("click")}},k.getActiveNav=function(){return this.$navWrap.find("li.active a").attr("href").slice(1)},a.exports=k}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},215:function(t,e,i){var a;a=function(t,e,a){var n=i(161),s=new n;a.exports=s}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},216:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(152),r=i(151),o=r.bom.bomIcon,l={tpl:new EJS({url:"/src/tpl/custom/aside/text-items-tpl"}),category:"text"},c=function(t,e){this.state=!1,this.options=n.extend({},c.options,"object"==typeof t&&t),this.type=e};c.options={bomIconUrl:o,tpl:new EJS({url:"/src/tpl/custom/aside/icon-items-tpl"}),category:"icon"},c.fn=c.prototype,c.fn.init=function(t){return this.state?void 0:(this.$element=t,this.$scrollList=t.find(".scroll-list"),this.$paginationWrap=t.find(".pagination-wrap"),this.$prevLabel=this.$paginationWrap.find(".ctr-label.prev"),this.$nextLabel=this.$paginationWrap.find(".ctr-label.next"),this.$currPageNum=this.$paginationWrap.find(".num span"),this.$pageNumInput=this.$paginationWrap.find(".form-control"),this.$totalPage=this.$element.find(".num"),this.state=!0,this)},c.fn.getState=function(){return this.state},c.fn.setState=function(t){!s.isBoolean(t)&&(t=!1),this.state=t},c.fn.getActiveItemId=function(){var t=this.$scrollList.children(".active");return t.length>0?t.data("id"):-1},c.fn.setActiveItem=function(t){this.clear(),this.$scrollList.children(".item[data-id="+t+"]").addClass("active")},c.fn.resetList=function(t,e){if(s.isArray(t)&&t.length>0){this.$scrollList.children().remove();var i=this.options.tpl.render({id:e,data:t,url:o});this.$scrollList.append(i)}},c.fn.updatePagination=function(t,e){!e&&(e=1);var i=this.$paginationWrap;1>=t?i.addClass("hide"):i.removeClass("hide"),this.$prevLabel.removeClass("disable"),this.$nextLabel.removeClass("disable"),1==e&&this.$prevLabel.addClass("disable"),e==t&&this.$nextLabel.addClass("disable"),this.$totalPage.html(e+"/"+t),this.$pageNumInput.val(1)},c.fn.clear=function(){this.$scrollList.children(".active").removeClass("active")},c.fn.getCurrPageNum=function(){return s.parseNum(this.$pageNumInput.val())},c.fn.getType=function(){return this.type};var h=new c(l,"canvas"),u=new c(l,"glass"),d=new c(null,"line"),p=new c(l,"paper"),m=new c(null,"template"),f=new c(l,"template"),g=new c(l,"template"),v=new c(l,"template"),b=new c(l,"template"),y=new c(null,"template"),C=new c(l,"tplCanvas");a.exports={canvas:h,glass:u,line:d,paper:p,scrollTpl:m,cupTpl:f,bolsterTpl:g,shirtTpl:v,bagTpl:b,template:y,tplCanvas:C}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},217:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(163),r=i(152),o=i(151),l=(i(211),i(215)),c=o.image.show,h=o.image.upload,u=new EJS({url:"/src/tpl/custom/aside/image-items-tpl"}),d=new EJS({url:"/src/tpl/custom/aside/image-uploaditem-tpl"}),p=65,m=s.IMGPAGESIZE,f={state:!1,init:function(t,e){return this.state?void 0:(this.$element=t,this.$scrollList=t.find(".scroll-list"),this.$addImgBtn=n("#upload-btn"),this.$paginationWrap=t.find(".pagination-wrap"),this.$currPageNum=this.$paginationWrap.find(".num span"),this.$pageNumInput=this.$paginationWrap.find(".form-control"),this.$totalPage=this.$element.find(".num"),this.currPage=1,this.state=!0,this._initUploader(),this.initTpl(e),this)},initTpl:function(t,e){var i=this,a=i.$scrollList.children(".item"),s=null,o=null;i.clear(),a.each(function(){s=n(this),n(this).data("id")==t&&n(this).addClass("active"),n(this).hasClass("stat-load")||!function(t){o={imgSrc:t.data("image"),$img:t.find("img"),$item:t},i.imgEv(o)}(s)}),r.isFunction(e)&&e()},getState:function(){return this.state},setState:function(t){!r.isBoolean(t)&&(t=!1),this.state=t},_initUploader:function(){var t=this,e=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"upload-btn",url:h,flash_swf_url:"/js/Moxie.swf",silverlight_xap_url:"/js/Moxie.xap",file_data_name:"image",filters:{max_file_size:"100mb",mime_types:[{title:"Image files",extensions:"jpg,png,jpeg"}],prevent_duplicates:!0},max_retries:2}),i={};e.init(),e.bind("FilesAdded",function(a,n){var r=e.files.length;r>s.IMGPAGESIZE&&(e.splice(s.IMGPAGESIZE,r-s.IMGPAGESIZE),l.emit("upload.filesAdded.error","每页最多上传11张图片"));var o=t.addHolderItem(e.files.length),c=null;e.files.forEach(function(t,e,a){c=o.eq(e),i[t.id]={obj:c,per:c.find(".per")}}),l.emit("upload.filesAdded.beforestart"),e.start()}),e.bind("UploadProgress",function(t,e){i[e.id].per.text(e.percent+"%")}),e.bind("FileUploaded",function(a,n,s){var r=JSON.parse(s.response);return e.removeFile(n),r.Error?(t.uploadFail(i[n.id].obj),void l.emit("upload.fileUploaded.error",r.Error)):void(r.File&&(t.holder2Official(i[n.id],r.Id,r.File),l.emit("add.img",r),i[n.id]&&delete i[n.id]))}),e.bind("UploadComplete",function(e,i){t.$scrollList.children(".item").length>=m&&l.emit("upload.done")}),e.bind("Error",function(e,a){l.emit("upload.error",a.message),t.uploadFail(i[a.file.id].obj)})},getActiveItemId:function(){var t=this.$scrollList.children(".active");return t.length>0?t.data("id"):-1},setActiveItem:function(t){this.clear(),this.$scrollList.children(".item[data-id="+t+"]").addClass("active")},resetList:function(t,e,i){var a=this;if(r.isArray(t)&&t.length>0){var s=a.$scrollList.children(".stat-holder");t.splice(0,s.length);var o=u.render({id:e,data:t,url:c}),l=null,h=null;a.$scrollList.children(".stat-load").remove(),a.$scrollList.children(".stat-error").remove(),a.$scrollList.find(".item").remove(),a.$scrollList.append(o),a.$scrollList.children().each(function(t,e){h=n(this),function(t){l={imgSrc:t.data("image"),$img:t.find("img"),$item:t},a.imgEv(l)}(h)}),r.isFunction(i)&&i()}},addHolderItem:function(t){if(t){var e=d.render({len:t});return this.$addImgBtn.after(e),this.$scrollList.find(".stat-holder")}},holder2Official:function(t,e,i){var a=c+"/"+e+"/200/"+i,n=t.obj,s=n.find("img"),r=null;n.data("id",e),t.per.addClass("hide"),r={imgSrc:a,$img:s,$item:n},n.removeClass("stat-holder"),this.imgEv(r,function(){s.removeClass("hide")})},uploadFail:function(t){t.removeClass("stat-holder").addClass("stat-error")},clear:function(){this.$scrollList.children(".active").removeClass("active")},imgEv:function(t,e,i){if(t.imgSrc&&t.$img&&t.$item){var a=this;r.onImgEvent(t.imgSrc,function(i){var s=a.cropImg(i.width,i.height),o=n(i);t.$img.css({width:s.width,height:s.height}).attr("src",o.attr("src")),t.$item.addClass("stat-load"),r.isFunction(e)&&e()},function(){t.$item.addClass("stat-error"),r.isFunction(i)&&i()})}},cropImg:function(t,e){var i,a;return t>e?(i=p,a=e*p/t):e>t?(a=p,i=t*p/e):(i=p,a=p),{width:i,height:a}},setImgSrc:function(t,e,i){var a=this.cropImg(i.width,i.height);t.attr("src",e).css({width:a.width,height:a.height}).removeClass("hide"),t.closest("li").removeClass("stat-wait").addClass("stat-load")},getCurrPageNum:function(){return r.parseNum(this.$pageNumInput.val())},getType:function(){return"image"}};a.exports=f}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},218:function(t,e,i){var a;a=function(t,e,a){function n(t){if(!t)return 0;var e=t.Width,i=t.Height;return e>i?1:e==i?2:3}i(185);var s=i(147),r=i(152),o=new EJS({url:"/src/tpl/custom/aside/size-items-tpl"});a.exports={state:!1,init:function(t,e,i){return this.state?void 0:(this.$element=t,this.$regularSize=t.find(".size-regular"),this.$multiMatSize=t.find(".size-multimat"),this.$scrollList=this.$regularSize.find(".scroll-list"),this.$multiSizeSL=this.$multiMatSize.find(".scroll-list"),this.$sizeTabNav=this.$regularSize.find(".size-shape-tab"),this.$sizeCont=this.$regularSize.find(".size-cont"),this.currType=i||1,this.$element.on("click",".size-shape-tab a",function(t){t.preventDefault(),s(this).tab("show")}),1===this.currType?this.showListByShape(e):2===this.currType&&this.showMultiSize(e,!0),this)},setActiveItem:function(t,e){if(t&&t.Width&&t.Height){e||(e=1);var i=this.getScrollList(e);i&&(i.children(".active").removeClass("active"),i.children(".item").each(function(){return s(this).data("width")==t.Width&&s(this).data("height")==t.Height?(s(this).addClass("active"),!1):void 0}))}},clear:function(t){var e=this.getScrollList(t);e&&e.children(".active").removeClass("active")},getScrollList:function(t){var e=null;return 1===t?e=this.$scrollList:2===t&&(e=this.$multiSizeSL),e},showMultiSize:function(t,e){if(e){this.$multiSizeSL.children().remove();var i={Width:t.Width,Height:t.Height},a={Width:t.Height,Height:t.Width},n=o.render({size:t,data:[i,a]});this.$multiSizeSL.append(n)}return this.$multiMatSize.hasClass("hide")&&(this.$regularSize.addClass("hide"),this.$multiMatSize.removeClass("hide")),this},showRegularSize:function(t){return this.$regularSize.removeClass("hide"),this.$multiMatSize.addClass("hide"),t&&this.showListByShape(t),this},resetRegularList:function(t,e){if(t){this.$scrollList.children().remove();var i,a,n;t.s&&(i=o.render({size:e,data:t.s})),t.v&&(a=o.render({size:e,data:t.v})),t.h&&(n=o.render({size:e,data:t.h})),i&&this.$sizeCont.filter(".size-s").find(".scroll-list").append(i),a&&this.$sizeCont.filter(".size-v").find(".scroll-list").append(a),n&&this.$sizeCont.filter(".size-h").find(".scroll-list").append(n)}},activeSize:function(t){var e=this.getScrollList(t);e&&e.children(".forbid").removeClass("forbid")},forbidSize:function(t){var e=this.getScrollList(t);e&&e.children(".item[data-mat=2]").addClass("forbid")},showListByShape:function(t){var e=n(t);if(1==e||2==e||3==e)switch(this.$sizeTabNav.children(".active").removeClass("active"),this.$sizeCont.removeClass("active"),e){case 1:this.$sizeTabNav.children(".size-h-item").addClass("active"),this.$sizeCont.filter(".size-h").addClass("active in");break;case 2:this.$sizeTabNav.children(".size-s-item").addClass("active"),this.$sizeCont.filter(".size-s").addClass("active in");break;case 3:this.$sizeTabNav.children(".size-v-item").addClass("active"),this.$sizeCont.filter(".size-v").addClass("active in")}return this},getState:function(){return this.state},setState:function(t){!r.isBoolean(t)&&(t=!1),this.state=t},getType:function(){return"size"},getSizePaneType:function(){return this.currType},isExistSize:function(t){return this.$multiSizeSL.children(".item[data-width="+t.Width+"][data-height="+t.Height+"]").length},getSource:function(){return this.$scrollList.data("source")},setSource:function(t){this.$scrollList.data("source",t)}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},219:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(152),r=i(215),o={state:!1,init:function(t,e){this.state||(this.$ele=t,this.$innerLine=n("#inner"),this.$outerLine=n("#outer"),this.$typeBtns=t.find(".rimless-btn"),this.$innerList=this.$innerLine.find(".scroll-list"),this.$outerList=this.$outerLine.find(".scroll-list"),this.state=!0,this.currType=e||"innerLine",this.showPanelByType(this.currType),this._regEv())},_regEv:function(){var t=this;this.$typeBtns.on("click",".btn",function(e){if(e.preventDefault(),!n(this).hasClass("disabled")){var i,a=n(this).attr("data-type");if(1==a)i="innerLine";else{if(2!=a)return;i="outerLine"}r.emit("select.rimLine",i,function(e){t.showPanelByType(i),t.setActiveItem(i,e)})}})},_getScrollList:function(t){var e=t||this.currType;return"innerLine"==e?this.$innerList:"outerLine"==e?this.$outerList:!1},showPanelByType:function(t){var e;switch(t){case"innerLine":this.$innerLine.hasClass("active")||(this.$innerLine.addClass("active"),this.$outerLine.removeClass("active")),e=1;break;case"outerLine":this.$outerLine.hasClass("active")||(this.$outerLine.addClass("active"),this.$innerLine.removeClass("active")),e=2;break;default:return!1}return this.$typeBtns.find(".btn.active").removeClass("active"),this.$typeBtns.find(".btn[data-type="+e+"]").addClass("active"),this.currType=t,this},setActiveItem:function(t,e){this.clear(t);var i=null;return"innerLine"===t?i=this.$innerList:"outerLine"===t&&(i=this.$outerList),i.children(".item[data-id="+e+"]").addClass("active"),this},getState:function(){return this.state},setState:function(t){!s.isBoolean(t)&&(t=!1),this.state=t},clear:function(t){var e=t||this.currType;this._getScrollList(e).children(".active").removeClass("active")},getType:function(){return this.currType}};a.exports=o}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},220:function(t,e,i){var a;a=function(t,e,a){function n(t){var e=new RegExp("site\\d","g"),i=e.exec(t);return i?i[0]:!1}i(185);var s=i(147),r=i(151),o=r.bom.bomIcon,l=i(152),c=i(215),h=new EJS({url:"/src/tpl/custom/aside/icon-items-tpl"}),u={isClear:!1,state:!1,init:function(t,e){this.state||(this.$element=t,this.$matTypeWrap=t.find(".mat-hd-btn"),this.$matArea=s("#mat-list"),this.$multiMatArea=s("#multiMat-list"),this.$matSite=this.$matArea.find(".matsite-wrap"),this.$matTabCont=this.$matSite.siblings(".tab-content"),this.no=s("#no"),this.top=s("#top"),this.middle=s("#middle"),this.bottom=s("#bottom"),this.$plusMatBtn=this.$matSite.find(".i.plus"),this.$minusMatBtn=this.$matSite.find(".i.minus"),this.currType=e||"single",this.state=!0,this._regEv())},_regEv:function(){var t=this;this.$matSite.on("click",".i",function(e){e.preventDefault();var i=s(this),a=null;if(!i.hasClass("disable")){var r,o=t.$matSite,h=o.attr("class"),u=n(h),d=u?l.parseNum(u.slice(4)):0;if(u&&o.removeClass(u),i.hasClass("plus")){t.$minusMatBtn.removeClass("disable"),-1===d?r=1:3===d?(i.addClass("disable"),r=3):(2===d&&i.addClass("disable"),r=d+1),o.addClass("site"+r);var p=t.get1stBySite(r);switch(a={type:1,id:p,idx:r},r){case 1:a.site="top";break;case 2:a.site="middle";break;case 3:a.site="bottom"}}else if(i.hasClass("minus")){switch(t.$plusMatBtn.removeClass("disable"),-1===d||0===d?(i.addClass("disable"),r=0):(1===d&&i.addClass("disable"),r=d-1),o.addClass("site"+r),a={type:0,idx:r},r+1){case 1:a.site="top";break;case 2:a.site="middle";break;case 3:a.site="bottom"}t.removeActiveItem(r+1)}t.$matTabCont.children(".tab-pane.active").removeClass("active"),0===r||-1===r?t.no.addClass("active"):o.find(".site").eq(r-1).removeClass("active").children(".btn").trigger("click"),c.emit("set.matSite",a)}}).on("click",".btn",function(t){t.preventDefault(),s(this).tab("show")}),this.$matTypeWrap.on("click",".btn",function(e){if(e.preventDefault(),!s(this).hasClass("active")&&!s(this).hasClass("disabled")){var i=s(this).data("type");c.emit("select.matType",function(e){t.showPanelByType(i,e)},i)}})},showPanelByType:function(t,e){var i=t||this.currType;switch(i){case"single":this.$matArea.hasClass("active")||(this.$matArea.addClass("active"),this.$multiMatArea.removeClass("active")),this.initMatSite(e);break;case"multi":this.$multiMatArea.hasClass("active")||(this.$multiMatArea.addClass("active"),this.$matArea.removeClass("active")),l.isArray(e)&&this.setActiveItem("multi",e[0]);break;default:return!1}this.$matTypeWrap.find(".btn.active").removeClass("active"),this.$matTypeWrap.find(".btn[data-type="+t+"]").addClass("active"),this.currType=t},initMatSite:function(t){var e=this.$matSite.attr("class"),i=n(e);if(i&&this.$matSite.removeClass(i),this.$matTabCont.children(".tab-pane.active").removeClass("active"),!l.isArray(t))return this.$matSite.addClass("site0"),this.no.addClass("active"),void this.$minusMatBtn.addClass("disable");var a=this.$matSite.find(".site"),s=t.length;a.removeClass("active"),this.$matSite.addClass("site"+s),0===s&&this.no.addClass("active"),s>=1&&(this.$minusMatBtn.removeClass("disable"),a.eq(0).addClass("active"),this.top.addClass("active"),this.setAllActiveItem(t))},get1stBySite:function(t){var e=null,i=0,a=null;switch(t){case 0:break;case 1:e=this.top.find(".scroll-list");break;case 2:e=this.middle.find(".scroll-list");break;case 3:e=this.bottom.find(".scroll-list")}return e&&(a=e.children().eq(0),i=l.parseNum(a.attr("data-id")),a.addClass("active")),i},removeActiveItem:function(t){var e=null;switch(t){case 0:break;case 1:e=this.top.find(".scroll-list");break;case 2:e=this.middle.find(".scroll-list");break;case 3:e=this.bottom.find(".scroll-list")}e&&e.children(".active").removeClass("active")},getActiveItemId:function(){var t=this[this.getCurrSite()].find(".scroll-list").children(".active");return t.length>0?t.data("id"):-1},setActiveItem:function(t,e,i){var a=null;return"single"===t?a=this[i].find(".scroll-list"):"multi"===t&&(a=this.$multiMatArea.find(".scroll-list")),a.length<=0?!1:(a.children(".active").removeClass("active"),void a.children("[data-id="+e+"]").addClass("active"))},getCurrSite:function(){return this.$matSite.find(".site.active").attr("data-site")},clear:function(t,e){var i=t||this.currType;"single"===i?this[e].find(".scroll-list").children(".active").removeClass("active"):"multi"===i&&this.$multiMatArea.find(".scroll-list").children(".active").removeClass("active")},changeBtnState:function(t){!l.isBoolean(t)&&(t=!1),t?this.$plusMatBtn.removeClass("disable"):this.$plusMatBtn.addClass("disable")},getType:function(){return this.currType},getState:function(){return this.state},setState:function(t){!l.isBoolean(t)&&(t=!1),this.state=t},resetList:function(t,e,i,a){if(l.isArray(e)){var n=null;if("single"===t)n=this[a].find(".scroll-list");else{if("multi"!==t)return;n=this.$multiMatArea.find(".scroll-list")}n.children().remove();var s=h.render({id:i,data:e,url:o});n.append(s)}},forbidSingleMat:function(){var t=this.$matSite.attr("class"),e=n(t);e&&this.$matSite.removeClass(e),this.$matSite.addClass("site0"),this.$matTabCont.children(".tab-pane.active").removeClass("active"),this.no.addClass("active"),this.$plusMatBtn.addClass("disable")},setAllActiveItem:function(t){!l.isArray(t)||t.length<=0||(t[0]&&this.setActiveItem("single",t[0],"top"),t[1]&&this.setActiveItem("single",t[1],"middle"),t[2]&&this.setActiveItem("single",t[2],"bottom"))},selectStyle:function(t){t?(this.$matTypeWrap.addClass("hide"),this.$plusMatBtn.addClass("hide"),this.$minusMatBtn.addClass("hide")):(this.$matTypeWrap.removeClass("hide"),this.$plusMatBtn.removeClass("hide"),this.$minusMatBtn.removeClass("hide"))},switchSite2Idx:function(t){var e;switch(t){case"top":e=0;break;case"middle":e=1;break;case"bottom":e=2}return e}};a.exports=u}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},221:function(t,e,i){var a;a=function(t,e,a){var n=i(147),s=i(152),r=i(215);a.exports={state:!1,init:function(t){this.state||(this.$element=t,this.$top=t.find(".top-spa .form-control"),this.$topSiblings=this.$top.siblings(".i"),this.$right=t.find(".right-spa .form-control"),this.$rightSiblings=this.$right.siblings(".i"),this.$bottom=t.find(".bottom-spa .form-control"),this.$bottomSiblings=this.$bottom.siblings(".i"),this.$left=t.find(".left-spa .form-control"),this.$leftSiblings=this.$left.siblings(".i"),this.state=!0,this._regEv())},_regEv:function(){var t=null,e=!1;this.$element.on("click",".setting .i",function(){var t=n(this);r.emit("getData","size",function(e){var i=t.siblings(".form-control"),a=i.siblings(".i.minus"),n=i.siblings(".i.plus"),o=i.data("dire"),l=s.parseNum(i.val()),c={},h=s.parseNum(e.Width/30),u=s.parseNum(e.Height/30);if(!t.hasClass("disable")){if(t.hasClass("minus")&&l>0)l--;else{if(!t.hasClass("plus"))return;if(("top"==o||"bottom"==o)&&l>=u||("left"==o||"right"==o)&&l>=h)return;l++}a.removeClass("disable"),n.removeClass("disable"),0==l&&a.addClass("disable"),(("top"==o||"bottom"==o)&&l>=u||("left"==o||"right"==o)&&l>=h)&&n.addClass("disable"),i.val(l),c[o]=10*l,r.emit("after.setSpacer",c)}})}),this.$element.on("keydown",".setting .form-control",function(t){return 8==t.keyCode?void(e=!0):-1!==n.inArray(t.keyCode,[46,9,27,13,110,190])||65==t.keyCode&&t.ctrlKey===!0||t.keyCode>=35&&t.keyCode<=40?void(e=!1):void((t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)?(e=!1,t.preventDefault()):e=!0)}).on("keyup",".setting .form-control",function(i){if(i.stopPropagation(),i.preventDefault(),e){t&&clearTimeout(t);var a=n(this),o=n(this).data("dire"),l=n(this).siblings(".i.minus"),c=n(this).siblings(".i.plus"),h=n(this).val();t=setTimeout(function(){r.emit("getData","size",function(t){var e=s.parseNum(t.Width/30),i=s.parseNum(t.Height/30),n={};""===a.val()&&(h=0),("top"==o||"bottom"==o)&&h>=i?h=i:("left"==o||"right"==o)&&h>=e&&(h=e),l.removeClass("disable"),c.removeClass("disable"),0==h&&l.addClass("disable"),(("top"==o||"bottom"==o)&&h>=i||("left"==o||"right"==o)&&h>=e)&&c.addClass("disable"),n[o]=10*h,r.emit("after.setSpacer",n)})},200)}})},reset:function(){return this.$top.val(0),this.$bottom.val(0),this.$left.val(0),this.$right.val(0),this.$element.find(".i.plus.disable").removeClass("disable"),this.$element.find(".i.minus").addClass("disable"),this},setVal:function(t,e){if(t&&e){var i=s.parseNum(e.Width/30),a=s.parseNum(e.Height/30),n=t.top.mm/10,r=t.right.mm/10,o=t.bottom.mm/10,l=t.left.mm/10;this.$element.find(".i.plus.disable").removeClass("disable"),this.$element.find(".i.minus.disable").removeClass("disable"),this.$top.val(n),this.$bottom.val(o),this.$left.val(l),this.$right.val(r),n/10>=a&&(this.$topSiblings.filter(".plus").addClass("disable"),this.$topSiblings.filter(".minus").removeClass("disable")),n/10==0&&(this.$topSiblings.filter(".plus").removeClass("disable"),this.$topSiblings.filter(".minus").addClass("disable")),o>=a&&(this.$bottomSiblings.filter(".plus").addClass("disable"),this.$bottomSiblings.filter(".minus").removeClass("disable")),o/10==0&&(this.$bottomSiblings.filter(".plus").removeClass("disable"),this.$bottomSiblings.filter(".minus").addClass("disable")),
l>=i&&(this.$leftSiblings.filter(".plus").addClass("disable"),this.$leftSiblings.filter(".minus").removeClass("disable")),l/10==0&&(this.$leftSiblings.filter(".plus").removeClass("disable"),this.$leftSiblings.filter(".minus").addClass("disable")),r>=i&&(this.$rightSiblings.filter(".plus").addClass("disable"),this.$rightSiblings.filter(".minus").removeClass("disable")),r/10==0&&(this.$rightSiblings.filter(".plus").removeClass("disable"),this.$rightSiblings.filter(".minus").addClass("disable"))}},getState:function(){return this.state},setState:function(t){!_.isBoolean(t)&&(t=!1),this.state=t}}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},222:function(t,e,i){var a;a=function(t,e,a){i(205),i(223);var n=i(147),s=i(150),r=i(161),o=i(152),l=i(164),c=new r;c.init=function(t){this.$ele=t,this.$toolBar=this.$ele.siblings(".custom-toolbar"),this.$carouselWrap=t.find(".carousel"),this.$inner=t.find(".carousel-inner"),this.$batchBtn=t.find(".batch-btn"),this.$items=null,this.$boxes=null,this.picMap=[];var e=this;this.$carouselWrap.carousel({interval:!1}),this.$carouselWrap.on("slide.bs.carousel",function(t){var i=n(t.relatedTarget),a=e.$items.index(i);e.emit("show",a,e.picMap[a])}),this.$ele.on("click",".close",function(t){t.stopPropagation(),e.hide()}),this.$batchBtn.find("i").tooltip({title:"批量处理物料的添加",trigger:"hover",placement:"left"}),this.$batchBtn.on("click",function(t){t.stopPropagation();var i=e.$items.filter(".active.item"),a=e.$items.index(i);if(e.picMap[a]){n(this).addClass("disable");var s=e.picMap[a].getCustomData(),r=null;e.$items.each(function(t){return(r=e.picMap[t])?void e.emit("batch",s,r):!0}),n(this).removeClass("disable")}})},c.draw=function(t,e,i){var a=this;if(t===this.$ele.data("tplId"))return void s.each(e,function(t,i){a.picMap[i].hasTransform=!1,a.picMap[i].setCustomData(e[i],!0)});if(o.isArray(e)||!(e.length<0)){this.picMap=[],this.$ele.data("tplId",t),this.preEv(e);var n=null;s.each(e,function(t,i){t&&(n=l.create(t.type,a.$boxes.eq(i)),n.extend({isSub:!0}),n.on("initCanvasSize",function(t){t.canvasSize=a.getMainWidth()}),n.on("img.afterFire",function(t,e){a.emit("img.afterFire",t,e)}),n.on("transform.before",function(){a.$carouselWrap.addClass("loading")}),n.on("transform.done",function(t){a.$carouselWrap.removeClass("loading")}),n.on("imgUploadErr",function(t){a.emit("imgUploadErr",t)}),n.setCustomData(e[i],!0),a.picMap[i]=n)})}},c.preEv=function(t){var e="";this.$inner.children().remove(),s.each(t,function(t,i){e+='<div class="item"><span class="sub-num badge">'+(i+1)+'</span><div class="box box'+i+'"></div></div>'}),e&&this.$inner.append(e),this.$items=this.$inner.children(".item"),this.$boxes=this.$inner.find(".box")},c.show=function(t){this.$ele.addClass("show"),this.$toolBar.show(),!t&&(t=0),this.$items.removeClass("active"),this.$items.eq(t).addClass("active"),this.emit("show",t,this.picMap[t])},c.hide=function(){var t=[],e=[];return o.isArray(this.picMap)?(this.$toolBar.hide(),s.each(this.picMap,function(i){i&&i.markName&&(i.getImgData(),t.push(o.clone(i.getCustomData())),e.push(i.hasTransform?i.getPixel():null))}),this.$ele.removeClass("show"),void this.emit("hide",t,this.$ele.width(),e)):!1},c.addGetMainWidthEv=function(t){o.isFunction(t)&&(this.getMainWidth=t)},a.exports=c}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},223:function(t,e,i){var a;a=function(t){"use strict";function e(t){return this.each(function(){var e=a(this),i=e.data("bs.tooltip"),s="object"==typeof t&&t,r=s&&s.selector;(i||"destroy"!=t)&&(r?(i||e.data("bs.tooltip",i={}),i[r]||(i[r]=new n(this,s))):i||e.data("bs.tooltip",i=new n(this,s)),"string"==typeof t&&i[t]())})}var a=i(147),n=function(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)};n.VERSION="3.3.0",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,e,i){this.enabled=!0,this.type=t,this.$element=a(e),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var n=this.options.trigger.split(" "),s=n.length;s--;){var r=n[s];if("click"==r)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=r){var o="hover"==r?"mouseenter":"focusin",l="hover"==r?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=a.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},e=this.getDefaults();return this._options&&a.each(this._options,function(i,a){e[i]!=a&&(t[i]=a)}),t},n.prototype.enter=function(t){var e=t instanceof this.constructor?t:a(t.currentTarget).data("bs."+this.type);return e&&e.$tip&&e.$tip.is(":visible")?void(e.hoverState="in"):(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),a(t.currentTarget).data("bs."+this.type,e)),clearTimeout(e.timeout),e.hoverState="in",e.options.delay&&e.options.delay.show?void(e.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)):e.show())},n.prototype.leave=function(t){var e=t instanceof this.constructor?t:a(t.currentTarget).data("bs."+this.type);return e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),a(t.currentTarget).data("bs."+this.type,e)),clearTimeout(e.timeout),e.hoverState="out",e.options.delay&&e.options.delay.hide?void(e.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)):e.hide()},n.prototype.show=function(){var t=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var e=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!e)return;var i=this,s=this.tip(),r=this.getUID(this.type);this.setContent(),s.attr("id",r),this.$element.attr("aria-describedby",r),this.options.animation&&s.addClass("fade");var o="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(o);c&&(o=o.replace(l,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(o).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element);var h=this.getPosition(),u=s[0].offsetWidth,d=s[0].offsetHeight;if(c){var p=o,m=this.options.container?a(this.options.container):this.$element.parent(),f=this.getPosition(m);o="bottom"==o&&h.bottom+d>f.bottom?"top":"top"==o&&h.top-d<f.top?"bottom":"right"==o&&h.right+u>f.width?"left":"left"==o&&h.left-u<f.left?"right":o,s.removeClass(p).addClass(o)}var g=this.getCalculatedOffset(o,h,u,d);this.applyPlacement(g,o);var v=function(){var t=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==t&&i.leave(i)};a.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",v).emulateTransitionEnd(n.TRANSITION_DURATION):v()}},n.prototype.applyPlacement=function(t,e){var i=this.tip(),n=i[0].offsetWidth,s=i[0].offsetHeight,r=parseInt(i.css("margin-top"),10),o=parseInt(i.css("margin-left"),10);isNaN(r)&&(r=0),isNaN(o)&&(o=0),t.top=t.top+r,t.left=t.left+o,a.offset.setOffset(i[0],a.extend({using:function(t){i.css({top:Math.round(t.top),left:Math.round(t.left)})}},t),0),i.addClass("in");var l=i[0].offsetWidth,c=i[0].offsetHeight;"top"==e&&c!=s&&(t.top=t.top+s-c);var h=this.getViewportAdjustedDelta(e,t,l,c);h.left?t.left+=h.left:t.top+=h.top;var u=/top|bottom/.test(e),d=u?2*h.left-n+l:2*h.top-s+c,p=u?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(d,i[0][p],u)},n.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},n.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function e(){"in"!=i.hoverState&&s.detach(),i.$element.removeAttr("aria-describedby").trigger("hidden.bs."+i.type),t&&t()}var i=this,s=this.tip(),r=a.Event("hide.bs."+this.type);return this.$element.trigger(r),r.isDefaultPrevented()?void 0:(s.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",e).emulateTransitionEnd(n.TRANSITION_DURATION):e(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var e=t[0],i="BODY"==e.tagName,n=e.getBoundingClientRect();null==n.width&&(n=a.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var s=i?{top:0,left:0}:t.offset(),r={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},o=i?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},n,r,o,s)},n.prototype.getCalculatedOffset=function(t,e,i,a){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-a,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-a/2,left:e.left-i}:{top:e.top+e.height/2-a/2,left:e.left+e.width}},n.prototype.getViewportAdjustedDelta=function(t,e,i,a){var n={top:0,left:0};if(!this.$viewport)return n;var s=this.options.viewport&&this.options.viewport.padding||0,r=this.getPosition(this.$viewport);if(/right|left/.test(t)){var o=e.top-s-r.scroll,l=e.top+s-r.scroll+a;o<r.top?n.top=r.top-o:l>r.top+r.height&&(n.top=r.top+r.height-l)}else{var c=e.left-s,h=e.left+s+i;c<r.left?n.left=r.left-c:h>r.width&&(n.left=r.left+r.width-h)}return n},n.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},n.prototype.getUID=function(t){do t+=~~(1e6*Math.random());while(document.getElementById(t));return t},n.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var e=this;t&&(e=a(t.currentTarget).data("bs."+this.type),e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),a(t.currentTarget).data("bs."+this.type,e))),e.tip().hasClass("in")?e.leave(e):e.enter(e)},n.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type)})};var s=a.fn.tooltip;a.fn.tooltip=e,a.fn.tooltip.Constructor=n,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=s,this}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))},224:function(t,e,i){var a;a=function(t,e,a){i(186);var n,s=i(147),r=i(161),o=new EJS({url:"/src/tpl/common/gift-tpl"}),l=null,c=null,h=null,u={evName:"click",isLogin:!1,noBtn:!0},d=null,p=new r;p.init=function(t){u=s.extend({},u,"object"==typeof t&&t),n=o.render({isLogin:u.isLogin,noBtn:u.noBtn}),s("body").append(n),l=s(".gift-modal"),c=l.find(".image-list li"),h=c.eq(0),l.modal({show:!1}),u.trigger&&s(u.trigger).on(u.evName,function(t){t.preventDefault(),p.emit("beforeshow"),p.show(),p.emit("aftershow")}),l.on("hidden.bs.modal",function(){clearInterval(d),p.emit("hidden")})},p.slide=function(){function t(t){return c.index(t)}d&&clearInterval(d);var e=c.length;d=setInterval(function(){var i=c.filter(".active");i.length||(i=h,i.addClass("active"));var a=c.eq((t(i)+1)%e);i.removeClass("active"),s.support.transition?l.one("bsTransitionEnd",function(){a.addClass("active")}).emulateTransitionEnd(1e3):a.addClass("active")},4e3)},p.show=function(){this.slide(),l&&l.modal("show")},p.hide=function(){clearInterval(d),l&&l.modal("hide")},a.exports=p}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))}});